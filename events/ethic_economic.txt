namespace=ethic_economic 

country_event = { # 市场经济系统自动开关（月检）
    id = ethic_economic.0
    is_triggered_only = yes
    hide_window = yes
    trigger = { # AI不发生，节约算力并保护AI
        OR = {
			is_ai = no
			has_global_flag = economic_crisis_ai
		}
    }
    immediate={
        if = {
            limit = {
                rec_circle_able = yes
				rec_circle_access = yes
            }
			if = { # 尚未激活经济周期系统 - 激活系统
				limit = { NOT = { has_country_flag = ETHIC_MARKET_ECONOMY } }
				set_country_flag = ETHIC_MARKET_ECONOMY
				start_situation = { type = situation_economic_circle }
				every_situation = {
					limit = { is_situation_type = situation_economic_circle }
					add_situation_progress = 5
					
					set_variable = { which = rec_crisis_add value = 0 } # 初始化危机累积增加
					
					if = {
						limit = { years_passed < 1 }
						set_variable = { which = rec_crisis_accumulated value = 50 }
						set_variable = { which = rec_crisis_percentage value = 25 }
					}
					else = {
						set_variable = { which = rec_crisis_accumulated value = 0 }
						set_variable = { which = rec_crisis_percentage value = 0 }
					} # 初始化危机累积
					
					set_variable = { which = rec_crisis_threshold value = 200 } # 初始化阈值
				}
				owner = {
					rec_market_self_get = yes
					rec_market_common_get = yes
				
					# 初始化扩张数人口因子
					set_variable = { which = rec_expand_pop_0 value = 0 }
					set_variable = { which = rec_expand_pop_1 value = 0 }
					set_variable = { which = rec_expand_pop_2 value = 0 }
					# 初始化扩张数资源因子
					set_variable = { which = rec_expand_resource_0 value = 0 }
					set_variable = { which = rec_expand_resource_1 value = 0 }
					set_variable = { which = rec_expand_resource_2 value = 0 }
					
					set_variable = {
						which = market_revolution_size
						value = trigger:num_pops
					}
					if = { # 市场革命 - 开局如果是自资给12年
						limit = {
							is_egalitarian = yes
							years_passed < 1
						}
						set_timed_country_flag = { 
							flag = market_revolution_great
							years = 8
						}
						add_modifier = {
							modifier = cm_market_revolution
							years = 12
						}
					}
					else = { # 一般8年
						set_timed_country_flag = { 
							flag = market_revolution_great
							years = 4
						}
						add_modifier = {
							modifier = cm_market_revolution
							years = 8
						}
					}
				}
			}
			else = { # 已激活经济周期系统
			}
        }
		else = {
            remove_country_flag = ETHIC_MARKET_ECONOMY
			every_situation = {
				limit = { is_situation_type = situation_economic_circle }
				#destroy_situation = this
				add_situation_progress = -100
			}
		}
    }
}

# ethic_economic.1 和 ethic_economic.10
# 位于 ethic_economic_crisis.txt
# 神秘bug之11不存在，12hide_window没生效

situation_event = { # 缓冲事件
	id = ethic_economic.114514
    is_triggered_only = yes
    hide_window = yes
    immediate = {
    }
}
situation_event = { # 缓冲事件
	id = ethic_economic.1919
    is_triggered_only = yes
    hide_window = yes
    immediate = {
    }
}

situation_event = { # 计算情况改善-总结 1号
	id = ethic_economic.11
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		# 数值统一更新
		set_variable = { which = rec_situation_add_civic value = rec_situation_add_civic_temp } # 结算经济情况改善 - 国策基础
		set_variable = { which = rec_situation_mult_civic value = rec_situation_mult_civic_temp } # 结算经济情况改善 - 国策乘数
		set_variable = { which = rec_situation_add_edict value = rec_situation_add_edict_temp } # 结算经济状态改善 - 法令基础
		set_variable = { which = rec_situation_mult_edict value = rec_situation_mult_edict_temp } # 结算经济状态改善 - 法令乘数
		set_variable = { which = rec_situation_add_market value = rec_situation_add_market_temp } # 结算经济状态改善 - 市场
		set_variable = { which = rec_situation_add_approach value = rec_situation_add_approach_temp } # 结算经济状态改善 - 措施
		set_variable = { which = rec_situation_add_exploit value = rec_situation_add_exploit_temp } # 结算经济状态改善 - 剥削
		set_variable = { which = rec_situation_add_war value = rec_situation_add_war_temp } # 结算经济状态改善 - 战争
		
		owner = {
			set_variable = { which = rec_situation_add_civic value = prev.rec_situation_add_civic_temp } # 结算经济情况改善 - 国策基础
			set_variable = { which = rec_situation_mult_civic value = prev.rec_situation_mult_civic_temp } # 结算经济情况改善 - 国策乘数
			set_variable = { which = rec_situation_add_edict value = prev.rec_situation_add_edict_temp } # 结算经济状态改善 - 法令基础
			set_variable = { which = rec_situation_mult_edict value = prev.rec_situation_mult_edict_temp } # 结算经济状态改善 - 法令乘数
			set_variable = { which = rec_situation_add_market value = prev.rec_situation_add_market_temp } # 结算经济状态改善 - 市场
			set_variable = { which = rec_situation_add_approach value = prev.rec_situation_add_approach_temp } # 结算经济状态改善 - 措施
			set_variable = { which = rec_situation_add_exploit value = prev.rec_situation_add_exploit_temp } # 结算经济状态改善 - 剥削
			set_variable = { which = rec_situation_add_war value = prev.rec_situation_add_war_temp } # 结算经济状态改善 - 战争
		}
		
		set_variable = { which = rec_situation_improve value = rec_situation_improve_temp } # 结算经济状态改善 - 总结
		
		set_variable = { which = rec_economic_improve_temp value = 0 }
		
		situation_event = { id = ethic_economic.12 days = 5 }
    }
}

situation_event = { # 计算情况改善-国策基础 6号
    id = ethic_economic.12
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_situation_add_civic_temp value = 0 } # 初始化经济情况改善 - 国策基础
		# 政策
		if = { # 自由市场 +1.0增长
			limit={
				owner = { has_policy_flag = economic_stance_market }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 1 }
		}
		else_if = { # 受控市场 +0.8增长
			limit={
				owner = { has_policy_flag = economic_stance_mixed }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.8 }
		}
		if = { # 投资市场 +0.2增长
			limit={
				owner = { has_policy_flag = trade_policy_default }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.2 }
		}
		if = { # 私人所有制 +0.1增长
			limit={
				owner = { has_policy_flag = private_ownership }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.1 }
		}
		else_if = { # 混合所有制 -0.1增长
			limit={
				owner = { has_policy_flag = mixed_ownership }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.1 }
		}
		else_if = { # 国家所有制 -0.2增长
			limit={
				owner = { has_policy_flag = national_ownership }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.2 }
		}
		else_if = { # 集体所有制 -0.3增长
			limit={
				owner = { has_policy_flag = labor_ownership }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.3 }
		}
		else_if = { # 家族所有制 -0.4增长
			limit={
				owner = { has_policy_flag = family_ownership }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.4 }
		}
		# 国策
		if = { # 三倍利润 +3.0增长
			limit={
				owner = { has_valid_civic = civic_triple_the_profit }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 3 }
		}
		if = { # 金融精英/金融投资 +0.3增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_merchant_guilds
						has_valid_civic = civic_financial_investment
					}
				}
			}
		   change_variable = { which = rec_situation_add_civic_temp value = 0.3 }
		}
		if = { # 奢侈消费主义 +0.3增长
			limit={
				owner = { has_valid_civic = civic_consumerism }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.3 }
		}
		if = { # 资本狂热 +0.2增长
			limit={
				owner = { has_valid_civic = civic_corpus }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.2 }
		}
		if = { # 行业标兵 +0.2增长
			limit={
				owner = { has_valid_civic = civic_industry_pacesetter }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.2 }
		}
		if = { # 超节奏生活 +0.2增长
			limit={
				owner = { has_valid_civic = civic_super_fast_paced_life }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.2 }
		}
		if = { # 无休之季 +0.2增长
			limit={
				owner = { has_valid_civic = civic_eternal_jihad }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.2 }
		}
		if = { # 创新型经济/创新基金 +0.1增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_industrial_automatation
						has_valid_civic = civic_industrial_automatation_corporate
					}
				}
			}
		   change_variable = { which = rec_situation_add_civic_temp value = 0.1 }
		}
		if = { # 奴役暴君/奴隶行会/种姓制度/契约资产/死人上班 +0.1增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_reeducated_labor
						has_valid_civic = civic_slaver_guilds
						has_valid_civic = civic_divine_order
						has_valid_civic = civic_permanent_employment
						has_valid_civic = civic_indentured_assets
					}
				}
			}
		   change_variable = { which = rec_situation_add_civic_temp value = 0.1 }
		}
		if = { # 无情工业化/工业复合体 +0.1增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_industrial_economy
						has_valid_civic = civic_industrial_economy_corporate
					}
				}
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.1 }
		}
		if = { # 互联网市场 +0.1增长
			limit={
				owner = { has_valid_civic = civic_internet_market }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.1 }
		}
		if = { # 绩效考核 +0.1增长
			limit={
				owner = { has_valid_civic = civic_performance_appraisal }
			}
			change_variable = { which = rec_situation_add_civic_temp value = 0.1 }
		}
		if = { # 资本主义 +0.1增长
			limit={
				owner = {
					OR = {
                        has_ethic=ethic_capitalism
                        has_ethic=ethic_fanatic_capitalism
					}
				}
			}
		   change_variable = { which = rec_situation_add_civic_temp value = 0.1 }
		}
		if = { # 大康采恩 -0.1增长
			limit={
				owner = { has_valid_civic = civic_state_monopoly }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.1 }
		}
		if = { # 福利国家 -0.1增长
			limit={
				owner = { has_valid_civic = civic_welfare_state }
			}
			change_variable = { which = rec_situation_add_civic_temp value = -0.1 }
		}
		#if = { # 极简主义/禁欲主义 -0.1增长
		#	limit={
		#		owner = {
		#			has_valid_civic = civic_asceticism
		#		}
		#	}
		#	change_variable = { which = rec_situation_add_civic_temp value = -0.1 }
		#}
		
		round_variable_to_closest = {
			which = rec_situation_add_civic_temp
			value = 0.001
		}
		change_variable = { which = rec_economic_improve_temp value = rec_situation_add_civic_temp }
		
		situation_event = { id = ethic_economic.13 days = 5 }
    }
}
situation_event = { # 计算情况改善-国策乘数 11号
    id = ethic_economic.13
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		# 共同市场计算
		owner = {
			rec_market_self_get = yes
			rec_market_common_get = yes
		}
		
		set_variable = { which = rec_situation_mult_civic_temp value = 1 } # 初始化经济情况改善 - 国策乘数
		
		#round_variable_to_closest = {
		#	which = rec_situation_mult_civic_temp
		#	value = 0.001
		#}
		#multiply_variable = { which = rec_economic_improve_temp value = rec_situation_mult_civic_temp }
		
		
		situation_event = { id = ethic_economic.14 days = 5 }
    }
}
situation_event = { # 计算情况改善-法令基础 16号
    id = ethic_economic.14
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_situation_add_edict_temp value = 0 } # 初始化经济情况改善 - 法令基础
		if = { # 发放消费券 +0.3增长
			limit = {
				owner = { has_edict = economic_consumer_coupon }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.3 }
		}
		if = { # 通胀 +0.2增长
			limit = {
				owner = { has_edict = economic_inflaction }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.2 }
		}
		if = { # 福报 +0.2增长
			limit={
				owner = { has_edict = blessings }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.2 }
		}
		if = { # 消费主义宣传 +0.2增长
			limit={
				owner = { has_edict = consumerist_propaganda }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.2 }
		}
		if = { # 学术资源商业化 +0.1增长
			limit={
				owner = { has_edict = commercializing_academic_resources }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.1 }
		}
		if = { # 赎罪卷 +0.1增长
			limit={
				owner = { has_edict = enhanced_surveillance }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.1 }
		}
		if = { # 弹性工龄 +0.1增长
			limit={
				owner = { has_edict = the_flexible_seniority_act }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.1 }
		}
		if = { # 反通胀 -0.2增长
			limit = {
				owner = { has_edict = economic_deinflaction }
			}
			change_variable = { which = rec_situation_add_edict_temp value = -0.2 }
		}
		if = { # 债券 +0.3增长
			limit = {
				owner = { has_edict = war_bonds }
			}
			change_variable = { which = rec_situation_add_edict_temp value = 0.3 }
		}
		
		round_variable_to_closest = {
			which = rec_situation_add_edict_temp
			value = 0.001
		}
		change_variable = { which = rec_economic_improve_temp value = rec_situation_add_edict_temp }
		
		situation_event = { id = ethic_economic.15 days = 5 }
    }
}
situation_event = { # 计算情况改善-法令乘数 21号
    id = ethic_economic.15
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_situation_mult_edict_temp value = 1 } # 初始化经济状态改善 - 法令乘数
		
		#round_variable_to_closest = {
		#	which = rec_situation_mult_edict_temp
		#	value = 0.001
		#}
		#multiply_variable = { which = rec_economic_improve_temp value = rec_situation_mult_edict_temp }
		
		situation_event = { id = ethic_economic.16 days = 5 }
    }
}
situation_event = { # 计算情况改善-其它 26号
    id = ethic_economic.16
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_situation_add_market_temp value = 0 } # 初始化经济状态改善 - 市场
		set_variable = { which = rec_situation_add_approach_temp value = 0 } # 初始化经济状态改善 - 措施
		set_variable = { which = rec_situation_add_exploit_temp value = 0 } # 初始化经济状态改善 - 剥削
		#set_variable = { which = rec_situation_add_war_temp value = 0 } # 初始化经济状态改善 - 战争 | 不进行归0处理
		
		if = { # 产业繁荣
			limit = {
				has_situation_flag = industrial_boom
			}
			change_variable = { which = rec_situation_add_market_temp value = 0.2 }
		}

		if = { # 伞の优化-贸易额总值影响 = 贸易总额/帝国规模 * 系数(0.005)
			limit = { has_global_flag = z_pf2_installed }
			set_variable = { which = trade_value_per_size value = owner.PF_var_cntr_TRADE_value }
			divide_variable = { which = trade_value_per_size value = owner.trigger:empire_size }
			subtract_variable = { which = trade_value_per_size value = 40 }
			multiply_variable = { which = trade_value_per_size value = 0.005 }

			if = { # 影响上限为3
				limit = { check_variable = { which = trade_value_per_size value > 1 } }
				change_variable = { which = rec_situation_add_market_temp value = 1 }
			}
			else = {
				change_variable = { which = rec_situation_add_market_temp value = trade_value_per_size }
			}
		}
		round_variable_to_closest = {
			which = rec_situation_add_market_temp
			value = 0.001
		}
		set_variable = { which = rec_situation_add_market value = rec_situation_add_market_temp }
		change_variable = { which = rec_economic_improve_temp value = rec_situation_add_market }
	
		if = { # 战时经济重整-经济恶化
			limit = { owner = { is_at_war = yes } }
			if = {
				limit = { NOT = { has_situation_flag = economic_at_war } }
				set_situation_flag = economic_at_war
				set_variable = { which = rec_situation_add_war_temp value = 0 }
			}
		
			if = {
				limit = { check_variable = { which = rec_situation_add_war_temp value > -3 } } # 最大为3
				change_variable = { which = rec_situation_add_war_temp value = -0.02 }
			}
		
			if = { # 衍生法令-战争债券
				limit = { owner = { has_edict = war_bonds } }
				change_variable = { which = rec_situation_add_war_temp value = 0.015 } # 长期的债券并不能拯救经济
			}
		}
		else_if = {
			limit = { owner = { is_at_war = no } }
			set_variable = { which = rec_situation_add_war_temp value = 0 }
		}
		round_variable_to_closest = {
			which = rec_situation_add_war_temp
			value = 0.001
		}
		set_variable = { which = rec_situation_add_war value = rec_situation_add_war_temp }
		change_variable = { which = rec_economic_improve_temp value = rec_situation_add_war }
		
		if = { # 经济刺激项目 +0.5增长
			limit={
				rec_approach_is_stimulation = yes
			}
			change_variable = { which = rec_situation_add_approach_temp value = 0.5 }
		}
		else_if = { # 控制市场过热 -0.5增长
			limit={
				rec_approach_is_cooling = yes
			}
			change_variable = { which = rec_situation_add_approach_temp value = -0.5 }
		}
		else_if = { # 控制商品经济 -0.1增长
			limit={
				rec_approach_is_control = yes
			}
			change_variable = { which = rec_situation_add_approach_temp value = -0.1 }
		}
		round_variable_to_closest = {
			which = rec_situation_add_approach_temp
			value = 0.001
		}
		set_variable = { which = rec_situation_add_approach value = rec_situation_add_approach_temp }
		change_variable = { which = rec_economic_improve_temp value = rec_situation_add_approach }
		
		if = { # 宗主剥削
			limit = { is_overlord = yes }
			rec_benefit_exploit_get = yes
		}
		else = {
			set_variable = { which = rec_situation_add_exploit_temp value = 0 }
		}
		if = { # 附庸被剥削
			limit = { # 仅当有市场经济宗主时
				is_subject = yes
				overlord = { rec_circle_access = yes }
			}
			change_variable = { which = rec_situation_add_exploit_temp value = rec_situation_improve }
			multiply_variable = { which = rec_situation_add_exploit_temp value = -0.1 }
		}

		
		round_variable_to_closest = {
			which = rec_situation_add_exploit_temp
			value = 0.001
		}
		set_variable = { which = rec_situation_add_exploit value = rec_situation_add_exploit_temp }
		change_variable = { which = rec_economic_improve_temp value = rec_situation_add_exploit }
		
		round_variable_to_closest = {
			which = rec_economic_improve_temp
			value = 0.01
		}

		set_variable = { which = economic_mult_due_to_situation value = 0 } # 计算经济繁荣度
		if = {
			limit = { situation_progress >= 50 }
			set_variable = { which = economic_mult_due_to_situation value = trigger:situation_progress }
			subtract_variable = { which = economic_mult_due_to_situation value = 50 }
			multiply_variable = { which = economic_mult_due_to_situation value = 0.8 }
		}
		else_if = {
			limit = { situation_progress < 50 }
			set_variable = { which = economic_mult_due_to_situation value = trigger:situation_progress }
			multiply_variable = { which = economic_mult_due_to_situation value = -1 }
			change_variable = { which = economic_mult_due_to_situation value = 50 }
			multiply_variable = { which = economic_mult_due_to_situation value = -2 }
		}
		round_variable_to_closest = {
			which = economic_mult_due_to_situation
			value = 0.1
		}

		owner = { # 经济繁荣度buff
			add_modifier = {
				modifier = economic_mult_due_to_situation_modifier
				multiplier = from.economic_mult_due_to_situation
				clear_on_owner_change = yes
			}
		}
    }
}

situation_event = { # 计算危机阈值 2号
    id = ethic_economic.2
    is_triggered_only = yes
    hide_window = yes
    #trigger = {
    #    is_ai = no
    #}
    immediate = {
		
		set_variable = { which = rec_crisis_threshold value = 200 } # 初始化阈值
		
		if = { # 产业繁荣
			limit = {
				has_situation_flag = industrial_boom
			}
			change_variable = { which = rec_crisis_threshold value = 40 }
			if = { # 产业繁荣 - 新兴产业
				limit = {
					owner = { has_modifier = cm_industrial_boom_new }
				}
				change_variable = { which = rec_crisis_threshold value = 40 }
			}
		}
		
		if = { # 经济过热 +80阈值
			limit={ situation_progress > 90 }
			change_variable = { which = rec_crisis_threshold value = 80 }
		}
		if = { # 货币宽松 +40阈值
			limit = { owner = { has_edict = economic_inflaction } }
			change_variable = { which = rec_crisis_threshold value = 40 }
		}
		else_if = { # 抑制通胀 -20阈值
			limit = { owner = { has_edict = economic_deinflaction } }
			change_variable = { which = rec_crisis_threshold value = -20 }
		}
		if = { # 发放代金券 +40阈值 暂时没做
			limit = { has_edict = economic_distribute_tickets }
			change_variable = { which = rec_crisis_threshold value = 40 }
		}
		if = { # 额外印钞 +40阈值 暂时没做
			limit = { has_edict = economic_extra_printing }
			change_variable = { which = rec_crisis_threshold value = 40 }
		}
		
        if = { # 更多思潮内容
            limit = { has_global_flag = cultural_overhaul_active }
			if = { # 奴役暴君/奴隶行会/种姓制度/契约资产/死人上班 -40阈值
				limit={
					#NOT = { has_situation_flag = economic_crisis }
					owner = {
						OR = {
							has_valid_civic = civic_reeducated_labor
							has_valid_civic = civic_slaver_guilds
							has_valid_civic = civic_divine_order
							has_valid_civic = civic_permanent_employment
							has_valid_civic = civic_indentured_assets
						}
					}
				}
				change_variable = { which = rec_crisis_threshold value = -40 }
			}
			if = { # 创新型经济/创新基金 +40阈值
				limit={
					#NOT = { has_situation_flag = economic_crisis }
					owner = {
						OR = {
							has_valid_civic = civic_industrial_automatation
							has_valid_civic = civic_industrial_automatation_corporate
						}
					}
				}
				change_variable = { which = rec_crisis_threshold value = 40 }
			}
			if = { # 房地产市场 +120阈值
				limit={
					NOT = { has_situation_flag = economic_crisis }
					owner = { has_valid_civic = civic_real_estate_market }
				}
				change_variable = { which = rec_crisis_threshold value = 120 }
			}
        }
		
		if = { # 经济危机乘数 *50%阈值
			limit = { has_situation_flag = economic_crisis }
			multiply_variable = { which = rec_crisis_threshold value = 0.5 }
		}
		
		set_variable = { which = rec_crisis_threshold_self value = rec_crisis_threshold }
		if = { # 共同市场危机阈值
			limit = { owner = { NOT = { check_variable = { which = rec_market_common_threshold value = 0 } } } }
			set_variable = { which = rec_crisis_threshold value = owner.rec_market_common_threshold }
			set_variable = { which = rec_crisis_threshold_change value = value:rec_crisis_threshold_change }
		}
		
		round_variable_to_closest = {
			which = rec_crisis_threshold
			value = 0.01
		}
    }
}

situation_event = { # 计算危机增长-有危机时 3号
    id = ethic_economic.30
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_add_temp value = 0 } # 初始化增长
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_market }
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_civic }
	
		set_variable = { which = rec_crisis_add_market value = 0 }
		if = { # 一般条件市场效应
			limit={
				situation_progress > 10
				situation_progress < 70
			}
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_2 }
            multiply_variable = { which = rec_crisis_add_market value = -2 }
		}
		else_if = { # 高度繁荣市场效应
			limit={
				situation_progress > 70
				situation_progress < 90
			}
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_3 }
            multiply_variable = { which = rec_crisis_add_market value = -2 }
		}
		else_if = { # 经济危机市场效应
			limit = { situation_progress < 10 }
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_1 }
            multiply_variable = { which = rec_crisis_add_market value = -2 }
		}
		else = { # 经济过热市场效应
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_4 }
            multiply_variable = { which = rec_crisis_add_market value = -2 }
		} # 初始化增长
		if = { # 市场变革
			limit = { owner = { has_modifier = cm_market_revolution } }
			change_variable = { which = rec_crisis_add_market value = value:crisis_decline_market_revolution }
		}
		round_variable_to_closest = {
			which = rec_crisis_add_market
			value = 0.001
		}
		
		set_variable = { which = rec_crisis_add_civic value = 0 }
		if = { # 受控市场 -0.1增长
			limit={ owner = { has_policy_flag = economic_stance_mixed } }
			change_variable = { which = rec_crisis_add_civic value = -0.1 }
		}
		if = { # 钓鱼佬/珊瑚礁 -0.1增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_anglers
						has_valid_civic = civic_anglers_lithoid
					}
				}
			}
			change_variable = { which = rec_crisis_add_civic value = -0.1 }
		}
		round_variable_to_closest = {
			which = rec_crisis_add_civic
			value = 0.001
		}
		
		round_variable_to_closest = {
			which = rec_crisis_add_temp
			value = 0.01
		}
    }
}
situation_event = { # 计算危机增长-无危机时-总结 3号
    id = ethic_economic.31
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_add_temp value = 0 } # 初始化增长
		
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_market }
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_civic }
		multiply_variable = { which = rec_crisis_add_temp value = rec_crisis_mult_civic }
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_edict }
		#multiply_variable = { which = rec_crisis_add_temp value = rec_crisis_mult_edict }
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_approach }
		
		situation_event = { id = ethic_economic.32 days = 5 }
    }
}
situation_event = { # 计算危机增长-无危机时-国策基础 8号
    id = ethic_economic.32
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_add_civic value = 0 } # 初始化危机累积增加 - 国策基础
		# 政策
		if = { # 受控市场 -0.1增长
			limit={
				owner = { has_policy_flag = economic_stance_mixed }
			}
			change_variable = { which = rec_crisis_add_civic value = -0.1 }
		}
		# 国策
		if = { # 三倍利润 +3.0增长
			limit={
				owner = { has_valid_civic = civic_triple_the_profit }
			}
			change_variable = { which = rec_crisis_add_civic value = 3 }
		}
		if = { # 金融精英/金融投资 -0.1增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_merchant_guilds
						has_valid_civic = civic_financial_investment
					}
				}
			}
		   change_variable = { which = rec_crisis_add_civic value = -0.1 }
		}
		if = { # 工人合作社 -0.1增长
			limit={
				owner = { has_valid_civic = civic_world_cooperative }
			}
			change_variable = { which = rec_crisis_add_civic value = -0.1 }
		}
		if = { # 钓鱼佬/珊瑚礁 -0.1增长
			limit={
				owner = {
					OR = {
						has_valid_civic = civic_anglers
						has_valid_civic = civic_anglers_lithoid
					}
				}
			}
			change_variable = { which = rec_crisis_add_civic value = -0.1 }
		}
		round_variable_to_closest = {
			which = rec_crisis_add_civic
			value = 0.001
		}
		
		situation_event = { id = ethic_economic.33 days = 5 }
    }
}
situation_event = { # 计算危机增长-无危机时-政策乘数 13号
    id = ethic_economic.33
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_mult_civic value = 1 } # 初始化危机累积增加 - 国策乘数
		# 政策
		if = { # 混合所有制 *0.9增长
			limit={
				owner = { has_policy_flag = mixed_ownership }
			}
			multiply_variable = { which = rec_crisis_mult_civic value = 0.9 }
		}
		else_if = { # 国家所有制 *0.8增长
			limit={
				owner = { has_policy_flag = national_ownership }
			}
			multiply_variable = { which = rec_crisis_mult_civic value = 0.8 }
		}
		else_if = { # 家族所有制 *0.7增长
			limit={
				owner = { has_policy_flag = family_ownership }
			}
			multiply_variable = { which = rec_crisis_mult_civic value = 0.7 }
		}
		else_if = { # 集体所有制 *0.6增长
			limit={
				owner = { has_policy_flag = labor_ownership }
			}
			multiply_variable = { which = rec_crisis_mult_civic value = 0.6 }
		}
		# 国策
        if = { # 福利国家 *0.9增长
            limit={
				owner = { has_valid_civic = civic_welfare_state }
			}
            multiply_variable = { which = rec_crisis_mult_civic value = 0.9 }
        }
        if = { # 生产社群/分产主义 *0.95增长
            limit={
                owner = {
                    OR = {
                        has_valid_civic = civic_production_community
                        has_valid_civic = civic_distributism
                    }
                }
			}
            multiply_variable = { which = rec_crisis_mult_civic value = 0.95 }
        }
        if = { # 工人宪法 *0.9增长
            limit={
				owner = { has_valid_civic = civic_peoples_republic }
			}
            multiply_variable = { which = rec_crisis_mult_civic value = 0.9 }
        }
        if = { # 军事经济 *0.9增长
            limit={
				owner = { has_policy_flag = economic_policy_military }
			}
            multiply_variable = { which = rec_crisis_mult_civic value = 0.9 }
        }
        if = { # 国有企业 *0.9增长
            limit={
				owner = { has_valid_civic = civic_state_owned_enterprises }
			}
            multiply_variable = { which = rec_crisis_mult_civic value = 0.9 }
        }
        #if = { # 社会主义 *0.9增长
        #    limit={
        #        owner = {
        #            OR = {
        #                has_ethic = ethic_socialism
        #                has_ethic = ethic_fanatic_socialism
        #            }
        #        }
		#	}
        #    multiply_variable = { which = rec_crisis_mult_civic value = 0.9 }
        #}
		round_variable_to_closest = {
			which = rec_crisis_mult_civic
			value = 0.001
		}
		
		situation_event = { id = ethic_economic.34 days = 5 }
    }
}
situation_event = { # 计算危机增长-无危机时-法令基础 18号
    id = ethic_economic.34
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_add_edict value = 0 } # 初始化危机累积增加 - 法令基础
		if = { # 福报 +0.1增长
			limit={
				owner = { has_edict = blessings }
			}
			change_variable = { which = rec_crisis_add_edict value = 0.1 }
		}
		if = { # 发放消费券 -0.6增长
			limit = {
				owner = { has_edict = economic_consumer_coupon }
			}
			change_variable = { which = rec_crisis_add_edict value = -0.6 }
		}
		if = { # 债券 -0.3增长
			limit = { owner = { has_edict = war_bonds } }
			change_variable = { which = rec_crisis_add_edict value = -0.3 }
		}
		round_variable_to_closest = {
			which = rec_crisis_add_edict
			value = 0.001
		}
		
		situation_event = { id = ethic_economic.35 days = 5 }
    }
}
situation_event = { # 计算危机增长-无危机时-法令乘数 23号
    id = ethic_economic.35
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_mult_edict value = 1 } # 初始化危机累积增加 - 法令乘数
		round_variable_to_closest = {
			which = rec_crisis_mult_edict
			value = 0.001
		}
		
		situation_event = { id = ethic_economic.36 days = 5 }
    }
}
situation_event = { # 计算危机增长-无危机时-其它 28号
    id = ethic_economic.36
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		set_variable = { which = rec_crisis_add_market value = 0 } # 初始化经济状态改善 - 市场
		set_variable = { which = rec_crisis_add_approach value = 0 } # 初始化危机累积增加 - 措施
		if = { # 一般条件市场效应
			limit = {
				situation_progress > 10
				situation_progress < 70
			}
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_2 }
            multiply_variable = { which = rec_crisis_add_market value = -1 }
		}
		else_if = { # 高度繁荣市场效应
			limit = {
				situation_progress > 70
				situation_progress < 90
			}
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_3 }
            multiply_variable = { which = rec_crisis_add_market value = -1 }
		}
		else_if = { # 经济危机市场效应
			limit = { situation_progress < 10 }
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_1 }
            multiply_variable = { which = rec_crisis_add_market value = -1 }
		}
		else = { # 经济过热市场效应
			set_variable = { which = rec_crisis_add_market value = value:economy_stage_rebalance_4 }
            multiply_variable = { which = rec_crisis_add_market value = -1 }
		}
		if = { # 市场变革
			limit = { owner = { has_modifier = cm_market_revolution } }
			owner = {
				if = {
					limit = { has_country_flag = market_revolution_great }
					change_variable = { which = rec_expand_pop_0 value = value:market_revolution_pop }
				}
				change_variable = { which = rec_expand_resource_0 value = value:market_revolution_resource }
				change_variable = { which = rec_expand_resource_1 value = value:market_revolution_resource }
				change_variable = { which = rec_expand_resource_2 value = value:market_revolution_resource }
			}
		}
		round_variable_to_closest = {
			which = rec_crisis_add_market
			value = 0.001
		}
		
		if = { # 控制商品经济 -0.2增长
			limit={
				rec_approach_is_control = yes
			}
			change_variable = { which = rec_crisis_add_approach value = -0.2 }
		}
    }
}

situation_event = { # 计算危机积累 4号
    id = ethic_economic.4
    is_triggered_only = yes
    hide_window = yes
    immediate = {
	
		set_variable = { which = rec_crisis_add_self value = rec_crisis_add_temp }
		if = { # 共同市场危机增长
			limit = { owner = { NOT = { check_variable = { which = rec_market_common_size value = rec_market_self_size } } } }
			set_variable = { which = rec_crisis_add_temp value = owner.rec_market_common_accumulate }
			set_variable = { which = rec_crisis_add_change value = value:rec_crisis_add_change }
			round_variable_to_closest = {
				which = rec_crisis_add_change
				value = 0.001
			}
		}
		else = {
			set_variable = { which = rec_crisis_add_change value = 0 }
		}
		
		if = { # 扩张效应 - 人口
			limit = {
				owner = { NOT = { check_variable = { which = rec_expand_pop_0 value = 0 } } }
			}
			set_variable = { which = rec_crisis_add_outside value = value:effect_expand_pop }
		}
		else = { set_variable = { which = rec_crisis_add_outside value = 0 } }
		if = { # 扩张效应 - 资源
			limit = {
				owner = { NOT = { check_variable = { which = rec_expand_resource_0 value = 0 } } }
			}
			change_variable = { which = rec_crisis_add_outside value = value:effect_expand_resource }
		}
		owner = {
			set_variable = { which = rec_expand_pop_0 value = rec_expand_pop_1 }
			set_variable = { which = rec_expand_pop_1 value = rec_expand_pop_2 }
			set_variable = { which = rec_expand_pop_2 value = 0 } # 3月缓冲
			set_variable = { which = rec_expand_resource_0 value = rec_expand_resource_1 }
			set_variable = { which = rec_expand_resource_1 value = rec_expand_resource_2 }
			set_variable = { which = rec_expand_resource_2 value = 0 } # 3月缓冲
		}
		round_variable_to_closest = {
			which = rec_crisis_add_outside
			value = 0.001
		}
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_outside }
		
		#if = { # 战时经济重整
		#	limit = { owner = { is_at_war = yes } }
		#	change_variable = { which = rec_crisis_add_war value = value:crisis_decline_war } # BUG，本该是set_variable，目前不修
		#}
		# 测试新版战争经济-提供少量危机减少
		if = { # 战时经济重整-释放危机压力
			limit = { owner = { is_at_war = yes } }
			set_variable = { which = rec_crisis_add_war value = value:crisis_decline_war } # 战争期间每月减少1%(0-2)危机积累
		}
		else = { set_variable = { which = rec_crisis_add_war value = 0 } }
		round_variable_to_closest = {
			which = rec_crisis_add_war
			value = 0.001
		}
		change_variable = { which = rec_crisis_add_temp value = rec_crisis_add_war }
		
		set_variable = { which = rec_crisis_add value = rec_crisis_add_temp }
		round_variable_to_closest = {
			which = rec_crisis_add
			value = 0.01
		}

		if = { # 积累结果不能为负
			limit = { check_variable = { which = rec_crisis_accumulated value < 0 } }
			set_variable = { which = rec_crisis_accumulated value = 0 }
		}
		round_variable_to_closest = {
			which = rec_crisis_accumulated
			value = 0.01
		}
		change_variable = { which = rec_crisis_accumulated value = rec_crisis_add }
		
		set_variable = { which = rec_crisis_percentage value = value:crisis_percentage }
		round_variable_to_closest = {
			which = rec_crisis_percentage
			value = 0.01
		}
    }
}

situation_event = { # 缓冲事件
	id = ethic_economic.810
    is_triggered_only = yes
    hide_window = yes
    immediate = {
    }
}

situation_event = { # 判断危机效果 5号
    id = ethic_economic.5
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		#顺带总结数据
		owner = {
			set_variable = { which = rec_economic_improve value = prev.rec_economic_improve }
			set_variable = { which = rec_economic_situation value = prev.trigger:situation_progress }
			set_variable = { which = rec_crisis_add_self value = prev.rec_crisis_add_self }
			set_variable = { which = rec_crisis_add value = prev.rec_crisis_add }
			set_variable = { which = rec_crisis_accumulated value = prev.rec_crisis_accumulated }
			set_variable = { which = rec_crisis_threshold_self value = prev.rec_crisis_threshold_self }
			set_variable = { which = rec_crisis_threshold value = prev.rec_crisis_threshold }
			
			rec_market_self_get = yes
			rec_market_common_get = yes
			
			round_variable_to_closest = {
				which = rec_market_common_accumulate
				value = 0.01
			}
			round_variable_to_closest = {
				which = rec_market_common_threshold
				value = 0.01
			}
		}
	
		if = { # 有危机时
			limit = { has_situation_flag = economic_crisis }
			if = { # 危机积累小于10，结束危机
				limit = { check_variable = { which = rec_crisis_accumulated value < 10 } }
				remove_situation_flag = economic_crisis
				owner = { remove_country_flag = rec_economic_crisis }
				situation_event = { id = ethic_economic_crisis.10 days = 25 }
			}
			if = { # 经济状况回正，结束危机
				limit = {
					situation_progress > 30
					situation_monthly_progress > 0
				}
				remove_situation_flag = economic_crisis
				owner = { remove_country_flag = rec_economic_crisis }
				situation_event = { id = ethic_economic_crisis.11 days = 25 }
			}
		}
		else_if = { # 危机积累超过危机阈值，爆发危机
			limit = { check_variable = { which = rec_crisis_accumulated value > rec_crisis_threshold } }
			set_situation_flag = economic_crisis
			owner = { set_country_flag = rec_economic_crisis }
			situation_event = { id = ethic_economic_crisis.0 days = 25 }
		}

		if = { # 危机积累60%以下，低危机
			limit = { check_variable = { which = rec_crisis_percentage value < 60 } }
			if = {
				limit = { NOT = { has_situation_flag = economic_crisis_distance_low } }
				set_situation_flag = economic_crisis_distance_low
				remove_situation_flag = economic_crisis_distance_middle
				remove_situation_flag = economic_crisis_distance_high
			}
		}
		else_if = { # 危机积累80%以下，中危机
			limit = { check_variable = { which = rec_crisis_percentage value < 80 } }
			if = {
				limit = { NOT = { has_situation_flag = economic_crisis_distance_middle } }
				remove_situation_flag = economic_crisis_distance_low
				set_situation_flag = economic_crisis_distance_middle
				remove_situation_flag = economic_crisis_distance_high
			}
		}
		else = { # 危机积累80%以上，高危机
			if = {
				limit = { NOT = { has_situation_flag = economic_crisis_distance_high } }
				remove_situation_flag = economic_crisis_distance_low
				remove_situation_flag = economic_crisis_distance_middle
				set_situation_flag = economic_crisis_distance_high
				create_message = {
					type = ETHIC_ECONOMIC_HIGH_CRISIS
					localization = ETHIC_ECONOMIC_HIGH_CRISIS_desc
					days = 30
					target = this 
					variable = {
						type = name 
						localization = COUNTRY 
						scope = owner
					} 
				}
			}
		}
    }
}

# 事件集
# 产业繁荣：中控事件 100
# 产业繁荣：新兴产业 101
# 产业繁荣：能源 102
# 产业繁荣：采矿 103
# 产业繁荣：食物 104
# 产业繁荣：轻工业 105
# 产业繁荣：重工业 106
# 产业繁荣：服务业 107
# 劳资关系：中控事件 110
# 劳资关系：提高工资 111
# 劳资关系：降低工资 112
# 劳资关系：延长工时 113
# 劳资关系：缩短工时 114
# 股市：中控事件 120
# 股市：空前牛市 121
# 股市：牛市 122
# 股市：熊市 123
# 股市：空前熊市 124
# 垄断：寡头兴起 130
# 垄断：广泛垄断 131
# 垄断：中小企业破产 132
# 圣塔菲：激进的冒险 150
# 转向实体经济 1901
# 转向虚拟经济 1902
# 超前消费 191
# 企业破产 192

situation_event = { # 经济周期月度中控事件-通用
    id = ethic_economic.990
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			#10 = {
			#	situation_event = { id = ethic_economic.150 }
			#}
		}
		if = { #危机事件集
			limit = { has_situation_flag = economic_crisis }
			situation_event = { id = ethic_economic.999 }
		}
		else = { #通常事件集
			situation_event = { id = ethic_economic.998 }
		}
		
		owner = {
			if = {
				limit = { 
					any_active_first_contact = { always = yes }
				}
				owner = {
					random_list = {
						1000 = {}
						300 = {
							country_event = { id = ethic_economic.150 }
						}
					}
				}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-崩溃状态
    id = ethic_economic.991
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-衰退状态
    id = ethic_economic.992
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-低迷状态
    id = ethic_economic.993
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-繁荣状态
    id = ethic_economic.994
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-高度繁荣状态
    id = ethic_economic.995
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-过热状态
    id = ethic_economic.996
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-正常状态
    id = ethic_economic.998
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
		
		if = { # 低危机事件集
			limit = { has_situation_flag = economic_crisis_distance_low }
			situation_event = { id = ethic_economic.9981 }
		}
		else_if = { # 高危机事件集
			limit = { has_situation_flag = economic_crisis_distance_high }
			situation_event = { id = ethic_economic.9983 }
		}
		else_if = { # 中危机事件集
			limit = { has_situation_flag = economic_crisis_distance_middle }
			situation_event = { id = ethic_economic.9982 }
		}
    }
}
situation_event = { # 经济周期月度中控事件-低危机状态
    id = ethic_economic.9981
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			20 = { # 产业繁荣
				situation_event = { id = ethic_economic.100 }
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-中危机状态
    id = ethic_economic.9982
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = { # 产业繁荣
				situation_event = { id = ethic_economic.100 }
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-高危机状态
    id = ethic_economic.9983
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		random_list = {
			1000 = {}
			10 = {
				#if = {}
			}
		}
    }
}
situation_event = { # 经济周期月度中控事件-危机状态
    id = ethic_economic.999
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		
    }
}
situation_event = { # 事件-产业繁荣中控
    id = ethic_economic.100
    is_triggered_only = yes
    hide_window = yes
    trigger = {
		NOT = { has_situation_flag = industrial_boom }
    }
    immediate={
		random_list = {
			5 = {
				situation_event = { id = ethic_economic.101 }
			}
			10 = {
				situation_event = { id = ethic_economic.102 }
			}
			10 = {
				situation_event = { id = ethic_economic.103 }
			}
			10 = {
				situation_event = { id = ethic_economic.104 }
			}
			20 = {
				situation_event = { id = ethic_economic.105 }
			}
			20 = {
				situation_event = { id = ethic_economic.106 }
			}
			20 = {
				situation_event = { id = ethic_economic.107 }
			}
		}
		hidden_effect = { set_situation_flag = industrial_boom }
    }
}
situation_event = { # 事件-产业繁荣：新兴产业
    id = ethic_economic.101
    is_triggered_only = yes
	title = ethic_economic.101.name
	desc = ethic_economic.101.desc
	picture = GFX_evt_city_planet
	option = { # 扩大投资
		name = ethic_economic.101.invest
		trigger = {
			always = no
		}
    }
	option = { # 好的
		name = ethic_economic.101.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_new
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
situation_event = { # 事件-产业繁荣：能源
    id = ethic_economic.102
    is_triggered_only = yes
	title = ethic_economic.102.name
	desc = ethic_economic.102.desc
	picture = GFX_evt_city_planet
	option = { # 好的
		name = ethic_economic.102.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_energy
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
situation_event = { # 事件-产业繁荣：采矿
    id = ethic_economic.103
    is_triggered_only = yes
	title = ethic_economic.103.name
	desc = ethic_economic.103.desc
	picture = GFX_evt_city_planet
	option = { # 好的
		name = ethic_economic.103.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_mineral
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
situation_event = { # 事件-产业繁荣：农业
    id = ethic_economic.104
    is_triggered_only = yes
	title = ethic_economic.104.name
	desc = ethic_economic.104.desc
	picture = GFX_evt_city_planet
	option = { # 好的
		name = ethic_economic.104.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_food
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
situation_event = { # 事件-产业繁荣：轻工业
    id = ethic_economic.105
    is_triggered_only = yes
	title = ethic_economic.105.name
	desc = ethic_economic.105.desc
	picture = GFX_evt_city_planet
	option = { # 好的
		name = ethic_economic.105.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_light
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
situation_event = { # 事件-产业繁荣：重工业
    id = ethic_economic.106
    is_triggered_only = yes
	title = ethic_economic.106.name
	desc = ethic_economic.106.desc
	picture = GFX_evt_city_planet
	option = { # 好的
		name = ethic_economic.106.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_heavy
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
situation_event = { # 事件-产业繁荣：服务业
    id = ethic_economic.107
    is_triggered_only = yes
	title = ethic_economic.107.name
	desc = ethic_economic.107.desc
	picture = GFX_evt_city_planet
	option = { # 好的
		name = ethic_economic.107.ok
		owner = {
			add_modifier = {
				modifier = cm_industrial_boom_serve
				years = 4
			}
		}
		hidden_effect = {
			set_timed_situation_flag = { 
				flag = industrial_boom
				years = 4
			}
		}
    }
}
# 繁荣事件 - 通用
situation_event = { # 事件-转向实体经济
    id = ethic_economic.110
    is_triggered_only = yes
    hide_window = yes
	title = ethic_economic.101.name
	desc = ethic_economic.101.desc
	picture = GFX_evt_city_planet
    trigger = {
        NOT = { has_situation_flag = economy_new_goods }
    }
    immediate={
		hidden_effect = { set_situation_flag = economy_new_goods }
    }
}
situation_event = { # 事件-转向虚拟经济
    id = ethic_economic.111
    is_triggered_only = yes
    hide_window = yes
	title = ethic_economic.101.name
	desc = ethic_economic.101.desc
	picture = GFX_evt_city_planet
    trigger = {
		always = yes
    }
    immediate={
		owner = { add_modifier = { modifier = cm_radical_first_contact years = 3 } }
    }
}
situation_event = { # 事件-工人：提高工资
    id = ethic_economic.112
    is_triggered_only = yes
    hide_window = yes
	title = ethic_economic.102.name
	desc = ethic_economic.102.desc
    trigger = {
        NOT = { has_situation_flag = economy_new_goods }
    }
    immediate={
		hidden_effect = { set_situation_flag = economy_new_goods }
    }
}
situation_event = { # 事件-工人：降低工时
    id = ethic_economic.113
    is_triggered_only = yes
    hide_window = yes
	title = ethic_economic.103.name
	desc = ethic_economic.103.desc
    trigger = {
        NOT = { has_situation_flag = economy_new_goods }
    }
    immediate={
		hidden_effect = { set_situation_flag = economy_new_goods }
    }
}

country_event = { # 事件-圣塔菲：激进的探险
    id = ethic_economic.150
    is_triggered_only = yes
	title = ethic_economic.150.name
	desc = ethic_economic.150.desc
    trigger = {
		NOT = { mid_game_years_passed >= 5 }
		owner = {
			has_edict = explorer_privitization
			NOT = { has_country_flag = radical_first_contact_done }
		}
    }
	option = { # 支持
		name = ethic_economic.150.a
		trigger = {
			OR = {
				has_policy_flag = first_contact_attack_allowed
				can_set_policy = { policy = first_contact_protocol option = first_contact_attack_allowed }
			}
		}
		owner = {
			if = {
				limit = { NOT = { has_policy_flag = first_contact_attack_allowed } }
				set_policy = {
					policy = first_contact_protocol
					option = first_contact_attack_allowed
					#cooldown = yes
				}
			}
			add_modifier = {
				modifier = cm_radical_first_contact
				years = 5
			}
			hidden_effect = {
				set_timed_country_flag = { 
					flag = radical_first_contact_done
					years = 5
				}
			}
		}
	}
	option = { # 默许
		name = ethic_economic.150.b
		trigger = {
			NOT = { has_ethic = ethic_fanatic_authoritarian }
			NOT = { has_ethic = ethic_fanatic_pacifist }
		}
		owner = {
			if = {
				limit = { NOT = { has_policy_flag = first_contact_attack_allowed } }
				set_policy = {
					policy = first_contact_protocol
					option = first_contact_attack_allowed
					#cooldown = yes
				}
			}
			add_modifier = {
				modifier = cm_radical_first_contact
				multiplier = 0.5
				years = 3
			}
			hidden_effect = {
				set_timed_country_flag = { 
					flag = radical_first_contact_done
					years = 3
				}
			}
		}
	}
	option = { # 反对
		name = ethic_economic.150.c
		hidden_effect = {
			set_timed_country_flag = { 
				flag = radical_first_contact_done
				years = 6
			}
		}
	}
}

situation_event = { # 事件-超前消费
    id = ethic_economic.191
    is_triggered_only = yes
	title = ethic_economic.191.name
	desc = ethic_economic.191.desc
    trigger = {
        NOT = { has_situation_flag = economy_new_goods }
    }
    immediate={
		hidden_effect = { set_situation_flag = economy_new_goods }
    }
	#走向垄断
}
situation_event = { # 事件-企业破产
    id = ethic_economic.192
    is_triggered_only = yes
	title = ethic_economic.192.name
	desc = ethic_economic.192.desc
    trigger = {
        NOT = { has_situation_flag = economy_new_goods }
    }
    immediate={
		hidden_effect = { set_situation_flag = economy_new_goods }
    }
	option = {
		name = ethic_economic.192.a
		icon = {
			icon = GFX_ethic_capitalism
			text = option_tooltip_capitalism
		}
	}
	option = {
		name = ethic_economic.192.b
		icon = {
			icon = GFX_ethic_egalitarian
			text = option_tooltip_egalitarian
		}
	}
	option = {
		name = ethic_economic.192.c
		icon = {
			icon = GFX_ethic_authoritarian
			text = option_tooltip_authoritarian
		}
	}
	option = {
		name = ethic_economic.192.d
		icon = {
			icon = GFX_civic_anarchy
			text = civic_anarchy
		}
	}
}


planet_event = { # 扩张效应-征服星球带来的危机稀释
    id = ethic_economic.90
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		from = {
			change_variable = { which = rec_expand_pop_0 value = trigger:num_pops }
		}
    }
}

planet_event = { # 提升效应-提升物种带来的危机稀释
    id = ethic_economic.91
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		owner = {
			change_variable = { which = rec_expand_pop_0 value = 2 }
			change_variable = { which = rec_expand_pop_1 value = 1 }
		}
    }
}

planet_event = { # 开拓效应-征服者私有化协议过程
    id = ethic_economic.92
    is_triggered_only = yes
    hide_window = yes
    trigger = {
		owner = { has_edict = explorer_privatization }
    }
    immediate = {
		add_modifier = {
			modifier = pm_explorer_privatized
			years = 1
			clear_on_owner_change = yes
		}
		planet_event = { id = ethic_economic.920 days = 30 }
    }
}
planet_event = { # 开拓效应-征服者私有化协议过程
    id = ethic_economic.920
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		if = {
			limit = { has_planet_modifier = pm_explorer_privatized }
			owner = { change_variable = { which = rec_expand_resource_0 value = 1 } }
			planet_event = { id = ethic_economic.920 days = 30 }
		}
    }
}
event = { # 战争效应-战争赔款的危机稀释
	id = ethic_economic.95
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		if = {
			limit = { exist = from }
			set_variable = { which = rec_pops_out value = from.value:num_pops }
			multiply_variable = { which = rec_pops_out value = 0.05 }
			from = {
				change_variable = { which = rec_expand_pop_0 value = rec_pops_out }
				change_variable = { which = rec_expand_pop_1 value = rec_pops_out }
				change_variable = { which = rec_expand_pop_2 value = rec_pops_out }
			}
		}
	}
}

situation_event = { # 魅魔酱的完美经济学教室
    id = ethic_economic.93
    is_triggered_only = yes
	hide_window = yes
	

    immediate = {
		if = { # crisis
			limit = { has_situation_flag = economic_crisis }
			if = { # high accumulated
				limit = { check_variable = { which = rec_crisis_accumulated value > 50 } }
				situation_event = { id = ethic_economic.9316 }
			}
			else = { # low accumulated
				situation_event = { id = ethic_economic.9317 }
			}
		}
		else = { # non-crisis
			if = { # low-crisis
				limit = { has_situation_flag = economic_crisis_distance_low }
				if = { # bad economic
					limit = { situation_progress < 45 }
					if = { # bad improve
						limit = { check_variable = { which = rec_situation_improve value < 0.3 } }
						if = { # at war
							limit = { is_at_war = yes }
							situation_event = { id = ethic_economic.9301 }
						}
						else = { # not at war
							situation_event = { id = ethic_economic.9302 }
						}
					}
					else = { # good improve
						situation_event = { id = ethic_economic.9303 }
					}
				}
				else_if = { # middle economic
					limit = { situation_progress < 65 }
					if = { # bad improve
						limit = { check_variable = { which = rec_situation_improve value < -0.2 } }
						situation_event = { id = ethic_economic.9304 }
					}
					else_if = { # perfect improve
						limit = { check_variable = { which = rec_situation_improve value < 0.3 } }
						situation_event = { id = ethic_economic.9305 }
					}
					else = { # too much improve
						situation_event = { id = ethic_economic.9306 }
					}
				}
				else = { # high economic
					situation_event = { id = ethic_economic.9307 }
				}
			}
			else_if = { # middle-crisis
				limit = { has_situation_flag = economic_crisis_distance_middle }
				if = { # bad economic
					limit = { situation_progress < 45 }
					if = { # bad improve
						limit = { check_variable = { which = rec_situation_improve value < 0.2 } }
						situation_event = { id = ethic_economic.9308 }
					}
					else = { # too much improve
						situation_event = { id = ethic_economic.9309 }
					}
				}
				else_if = { # middle economic
					limit = { situation_progress < 60 }
					if = { # good improve
						limit = { check_variable = { which = rec_situation_improve value < 0.3 } }
						situation_event = { id = ethic_economic.9310 }
					}

					else = { # too much improve
						situation_event = { id = ethic_economic.9311 }
					}
				}
				else = { # high economic
					if = { # good improve
						limit = { check_variable = { which = rec_situation_improve value < -0.3 } }
						situation_event = { id = ethic_economic.9312 }
					}
					else = { # too much improve
						situation_event = { id = ethic_economic.9313 }
					}
				}
			}
			else_if = { # high-crisis
				limit = { has_situation_flag = economic_crisis_distance_high }
				if = { # war
					limit = { owner = { is_militarist = yes } }
					situation_event = { id = ethic_economic.9314 }
				}
				else = { #trade
					situation_event = { id = ethic_economic.9314 }
				}
			}
		}
    }
}

situation_event = { # at war , bad economic , bad improve , low crisis
	id = ethic_economic.9301
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = war_economic_info
	picture = GFX_evt_city_planet
	option = {
		name = edict_advice
	}
	option = {
		name = war_advice
	}
	option = {
		name = economic_advice
	}
}
situation_event = { # not at war , bad economic , bad improve , low crisis
	id = ethic_economic.9302
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_progress_info
	picture = GFX_evt_city_planet
	option = {
		name = edict_advice
	}
	option = {
		name = economic_advice
	}
	option = {
		name = civic_advice
	}
}
situation_event = { # not at war , bad economic , good improve , low crisis
	id = ethic_economic.9303
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_good_future_info
	picture = GFX_evt_city_planet
	option = {
		name = edict_advice
	}
	option = {
		name = economic_advice
	}
	option = {
		name = trade_advice
	}
}
situation_event = { # not at war , mid economic , bad improve , low crisis
	id = ethic_economic.9304
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_progress_info
	picture = GFX_evt_city_planet
	option = {
		name = edict_advice
	}
	option = {
		name = trade_advice
	}
	option = {
		name = economic_advice
	}
}
situation_event = { # not at war , mid economic , perfect improve , low crisis
	id = ethic_economic.9305
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_good_info
	picture = GFX_evt_city_planet
	option = {
		name = trade_advice
	}
	option = {
		name = expand_advice
	}
	option = {
		name = economic_advice
	}
}
situation_event = { # not at war , mid economic , high improve , low crisis
	id = ethic_economic.9306
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_improve_info
	picture = GFX_evt_city_planet
	option = {
		name = civic_advice
	}
	option = {
		name = expand_advice
	}
	option = {
		name = policy_advice
	}
}
situation_event = { # not at war , high economic , low crisis
	id = ethic_economic.9307
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_progress_info
	picture = GFX_evt_city_planet
	option = {
		name = expand_advice
	}
	option = {
		name = policy_advice
	}
	option = {
		name = trade_advice
	}
}
situation_event = { # not at war , bad economic , bad improve , mid crisis
	id = ethic_economic.9308
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_progress_info
	picture = GFX_evt_city_planet
	option = {
		name = expand_advice
	}
	option = {
		name = trade_advice
	}
	option = {
		name = edict_advice
	}
}

situation_event = { # not at war , bad economic , high improve , mid crisis
	id = ethic_economic.9309
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_good_future_info
	picture = GFX_evt_city_planet
	option = {
		name = war_advice
	}
	option = {
		name = trade_advice
	}
	option = {
		name = edict_advice
	}
}
situation_event = { # not at war , mid economic , good improve , mid crisis
	id = ethic_economic.9310
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_crisis_info
	picture = GFX_evt_city_planet
	option = {
		name = edict_advice
	}
	option = {
		name = trade_advice
	}
	option = {
		name = expand_advice
	}
}

situation_event = { # not at war , mid economic , high improve , mid crisis
	id = ethic_economic.9311
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_progress_info
	picture = GFX_evt_city_planet
	option = {
		name = economic_advice
	}
	option = {
		name = trade_advice
	}
	option = {
		name = war_advice
	}
}
situation_event = { # not at war , high economic , good improve , mid crisis
	id = ethic_economic.9312
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_progress_info
	picture = GFX_evt_city_planet
	option = {
		name = edict_advice
	}
	option = {
		name = economic_advice
	}
	option = {
		name = war_advice
	}
}
situation_event = { # not at war , high economic , high improve , mid crisis
	id = ethic_economic.9313
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_crisis_desc
	picture = GFX_evt_city_planet
	option = {
		name = policy_advice
	}
	option = {
		name = economic_advice
	}
	option = {
		name = approach_advice
	}
}
situation_event = { # not at war , high economic , high improve , mid crisis
	id = ethic_economic.9314
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_crisis_info
	picture = GFX_evt_city_planet
	option = {
		name = war_advice
	}
	option = {
		name = trade_advice
	}
	option = {
		name = policy_advice
	}
}
situation_event = { # not at war , high economic , high improve , mid crisis
	id = ethic_economic.9316
	is_triggered_only = yes
	
	title = ethic_economic.classroom.title
	
	
	desc = economic_in_crisis_info
	picture = GFX_evt_city_planet
	option = {
		name = war_advice
	}
	option = {
		name = wait_advice
	}
	option = {
		name = expand_advice
	}
}
situation_event = { # not at war , high economic , high improve , mid crisis
	id = ethic_economic.9317
	is_triggered_only = yes
	title = ethic_economic.classroom.title
	
	
	desc = economic_in_crisis_info
	picture = GFX_evt_city_planet
	option = {
		name = approach_advice
	}
	option = {
		name = edict_advice
	}
	option = {
		name = policy_advice
	}
}