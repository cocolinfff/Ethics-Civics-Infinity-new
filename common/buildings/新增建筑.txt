@buildings_t1 = 2
@buildings_t2 = 4
@buildings_t3 = 8
@buildings_t4 = 12

#礼教宗祠
building_ancestral_hall = {
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = government

    building_sets = {
        urban
        government
    }
    potential = {
        exists = owner
        owner = {
            has_valid_civic = civic_home_country_isomorphism
        }
    }
    allow = {
        has_upgraded_capital = yes
        exists = owner
        owner = {
            NOT = { has_tradition = tr_revolution_adopt }
        }
    }
    destroy_trigger = {
        exists = owner
        owner = {
            OR = {
                is_regular_empire = no
                has_tradition = tr_revolution_adopt
            }
        }
    }
    inline_script = {
        script = jobs/building_ancestral_hall_jobs
    }
    #祭祖机制
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_regular_empire = yes
            }
        }
        planet_jobs_unity_produces_mult = 0.3
        multiplier = planet.paragon_home_country_isomorphism
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_imperial_authority = yes
            }
        }
        planet_stability_add = 5
        multiplier = planet.ruler_home_country_isomorphism
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }
    triggered_desc = {
        text = building_ancestral_hall_effect
    }
    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_imperial_authority = yes }
        }
        text = building_ancestral_hall_ruler_effect
    }
    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_imperial_authority = yes }
        }
        text = job_noble_effect_desc
    }
    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_not_rulers_society = no }
        }
        text = job_supervisor_effect_desc
    }
    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_not_rulers_society = yes }
        }
        text = job_culture_worker_effect_desc
    }
}

#礼部驻所
holding_ministry_of_rites_dispatch_office = {
    base_buildtime = @b2_time
    base_cap_amount = 1
    owner_type = subject_holding
    icon = holding_ministry_of_rites_dispatch_office

    category = government

    building_sets = {
        urban
        government
    }

    potential = {
        has_overlord_dlc = yes
        exists = owner
        owner = {
            has_valid_civic = civic_home_country_isomorphism
        }
    }

    allow = {
        exists = planet
        planet = { is_capital = yes }
    }

    planet_modifier = {
        job_overlord_emperors_apprentice_add = 100
    }

    triggered_planet_modifier = {
        potential = {
            exists = planet.owner
            planet.owner = { is_gestalt = yes }
        }
        job_overlord_emperors_apprentice_add = -100
        job_overlord_emperors_apprentice_drone_add = 100
    }

    resources = {
        category = planet_holdings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }

    triggered_desc = {
        text = job_overlord_emperors_apprentice_effect_desc
    }
}

#信息大厦
building_information_tower = {
    base_buildtime = 480
    base_cap_amount = 1
    category = government

    building_sets = {
        urban
        government
    }
    icon = holding_franchise_headquarters
    potential = {
        exists = owner
        owner = {
            OR = {
                has_valid_civic = civic_cybercap
                has_valid_civic = civic_corporate_cybercap
            }
        }
        NOT = { has_planet_flag = planetary_station }
    }
    destroy_trigger = {
        exists = owner
        owner = { is_hive_empire = yes }
    }
    #一级首都
    triggered_planet_modifier = {
        potential = {
            OR = {
                has_building = building_colony_shelter
                has_building = building_colony_shelter_nanotech
                has_building = building_low_tech_capital
                has_building = building_hab_capital
            }
        }
        modifier = {
            pop_government_ethic_attraction = 0.15
            planet_amenities_mult = 0.1
            planet_pops_trade_produces_mult = 0.15
            planet_pops_consumer_goods_upkeep_mult = 0.1
        }
    }
    #二级首都
    triggered_planet_modifier = {
        potential = {
            OR = {
                has_building = building_capital
                has_building = building_capital_nanotech
                has_building = building_hab_major_capital
                has_building = building_resort_capital
            }
        }
        modifier = {
            pop_government_ethic_attraction = 0.3
            planet_amenities_mult = 0.15
            planet_pops_trade_produces_mult = 0.3
            planet_pops_consumer_goods_upkeep_mult = 0.15
        }
    }
    #三级首都
    triggered_planet_modifier = {
        potential = {
            OR = {
                has_building = building_major_capital
                has_building = building_major_capital_nanotech
                has_building = building_hab_system_capital
                has_building = building_resort_major_capital
            }
        }
        modifier = {
            pop_government_ethic_attraction = 0.6
            planet_amenities_mult = 0.3
            planet_pops_trade_produces_mult = 0.6
            planet_pops_consumer_goods_upkeep_mult = 0.3
        }
    }
    #四级首都
    triggered_planet_modifier = {
        potential = {
            OR = {
                has_building = building_system_capital
                has_building = building_system_capital_nanotech
            }
        }
        modifier = {
            pop_government_ethic_attraction = 1.2
            planet_amenities_mult = 0.6
            planet_pops_trade_produces_mult = 1.2
            planet_pops_consumer_goods_upkeep_mult = 0.6
        }
    }
    #帝国首都
    triggered_planet_modifier = {
        potential = {
            OR = {
                has_building = building_imperial_capital
                has_building = building_hab_imperial_capital
            }
        }
        modifier = {
            pop_government_ethic_attraction = 2.5
            planet_amenities_mult = 1.2
            planet_pops_trade_produces_mult = 2.5
            planet_pops_consumer_goods_upkeep_mult = 1.2
        }
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = 1000
        }
        produces = {
            unity = 10
        }
        produces = {
            trigger = {
                OR = {
                    has_building = building_capital
                    has_building = building_capital_nanotech
                    has_building = building_hab_major_capital
                    has_building = building_resort_capital
                }
            }
            trade = 10
        }
        produces = {
            trigger = {
                OR = {
                    has_building = building_major_capital
                    has_building = building_major_capital_nanotech
                    has_building = building_hab_system_capital
                    has_building = building_resort_major_capital
                }
            }
            trade = 15
        }
        produces = {
            trigger = {
                OR = {
                    has_building = building_system_capital
                    has_building = building_system_capital_nanotech
                }
            }
            trade = 20
        }
        produces = {
            trigger = {
                OR = {
                    has_building = building_imperial_capital
                    has_building = building_hab_imperial_capital
                }
            }
            trade = 25
        }
        upkeep = {
            energy = 10
        }
        upkeep = {
            trigger = {
                OR = {
                    has_building = building_capital
                    has_building = building_capital_nanotech
                    has_building = building_hab_major_capital
                    has_building = building_resort_capital
                }
            }
            energy = 10
        }
        upkeep = {
            trigger = {
                OR = {
                    has_building = building_major_capital
                    has_building = building_major_capital_nanotech
                    has_building = building_hab_system_capital
                    has_building = building_resort_major_capital
                }
            }
            energy = 10
        }
        upkeep = {
            trigger = {
                OR = {
                    has_building = building_system_capital
                    has_building = building_system_capital_nanotech
                }
            }
            energy = 10
        }
        upkeep = {
            trigger = {
                OR = {
                    has_building = building_imperial_capital
                    has_building = building_hab_imperial_capital
                }
            }
            energy = 10
        }
    }
    ai_resource_production = {
        trigger = {
            planet = {
                OR = {
                    has_building = building_colony_shelter
                    has_building = building_colony_shelter_nanotech
                    has_building = building_low_tech_capital
                    has_building = building_hab_capital
                }
            }
        }
        administrative_capacity_calculation = 10
        physics_research = 10
        society_research = 10
        engineering_research = 10
    }
    ai_resource_production = {
        trigger = {
            planet = {
                OR = {
                    has_building = building_capital
                    has_building = building_capital_nanotech
                    has_building = building_hab_major_capital
                    has_building = building_resort_capital
                }
            }
        }
        administrative_capacity_calculation = 20
        physics_research = 20
        society_research = 20
        engineering_research = 20
    }
    ai_resource_production = {
        trigger = {
            planet = {
                OR = {
                    has_building = building_major_capital
                    has_building = building_major_capital_nanotech
                    has_building = building_hab_system_capital
                    has_building = building_resort_major_capital
                }
            }
        }
        administrative_capacity_calculation = 40
        physics_research = 40
        society_research = 40
        engineering_research = 40
    }
    ai_resource_production = {
        trigger = {
            planet = {
                OR = {
                    has_building = building_system_capital
                    has_building = building_system_capital_nanotech
                }
            }
        }
        administrative_capacity_calculation = 80
        physics_research = 60
        society_research = 60
        engineering_research = 60
    }
    ai_resource_production = {
        trigger = {
            planet = {
                OR = {
                    has_building = building_imperial_capital
                    has_building = building_hab_imperial_capital
                }
            }
        }
        administrative_capacity_calculation = 160
        physics_research = 100
        society_research = 100
        engineering_research = 100
    }
    ai_weight = {
        base = 5
        modifier = {
            factor = 1000
            owner = {
                has_monthly_income = {
                    resource = administrative_capacity_calculation
                    value < 0
                }
            }
        }
    }
}

#超弦计算机
building_superstring_theory_computer = {
    base_buildtime = @b1_time
    empire_limit = {
        base = 1
    }

    category = pop_assembly

    building_sets = {
        urban
        government
        research
    }

    potential = {
        exists = owner
        owner = { has_valid_civic = civic_history_mirror }

    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    country_modifier = {
        category_archaeostudies_research_speed_mult = 0.1
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
    }

    ai_resource_production = {
        society_research = 25
        unity = 15
    }
}

#教育中心
building_school_1 = {
    base_buildtime = @b1_time
    empire_limit = {
        base = 1
    }

    category = pop_assembly

    building_sets = {
        urban
        government
        research
    }

    potential = {
        NOT = { has_modifier = slave_colony }

    }

    destroy_trigger = {
        has_modifier = slave_colony
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    country_modifier = {
        country_leader_pool_size = 1
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_policy_flag = private_education
            }
        }
        modifier = {
            planet_pops_trade_produces_mult = 0.25
        }
    }

    upgrades = {
        "building_school_2"
    }

    prerequisites = {
        "tech_building_school_1"
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
    }

    ai_resource_production = {
        society_research = 5
        engineering_research = 5
        physics_research = 5
        unity = 10
    }
}

#星际学府
building_school_2 = {
    base_buildtime = @b2_time
    can_build = no

    category = pop_assembly

    building_sets = {
        urban
        government
        research
    }

    potential = {
        NOT = { has_modifier = slave_colony }
    }

    allow = {
        has_upgraded_capital = yes
    }

    destroy_trigger = {
        has_modifier = slave_colony
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            rare_crystals = @b2_rare_upkeep
        }
    }

    country_modifier = {
        country_leader_cap_add = 1
        country_leader_pool_size = 2
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_policy_flag = private_education
            }
        }
        modifier = {
            planet_pops_trade_produces_mult = 0.25
        }
    }

    upgrades = {
        "building_school_3"
    }

    prerequisites = {
        "tech_building_school_2"
    }

    ai_resource_production = {
        society_research = 15
        engineering_research = 15
        physics_research = 15
        unity = 30
    }
}

#银河大学
building_school_3 = {
    base_buildtime = @b3_time
    can_build = no

    category = pop_assembly

    building_sets = {
        urban
        government
        research
    }

    potential = {
        NOT = { has_modifier = slave_colony }
    }

    allow = {
        has_major_upgraded_capital = yes
    }

    destroy_trigger = {
        has_modifier = slave_colony
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b3_rare_cost
        }
        upkeep = {
            energy = @b3_upkeep
            rare_crystals = @b3_rare_upkeep
        }
    }

    country_modifier = {
        country_leader_cap_add = 1
        country_leader_pool_size = 2
        leader_initial_skill = 1
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_policy_flag = private_education
            }
        }
        modifier = {
            planet_pops_trade_produces_mult = 0.25
        }
    }


    prerequisites = {
        "tech_building_school_3"
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
    }

    ai_resource_production = {
        society_research = 50
        engineering_research = 50
        physics_research = 50
        unity = 30
    }
}

#格式塔商业区
building_commercial_zone_gestalt = {
    icon = building_commercial_zone
    base_buildtime = @b1_time
    category = trade

    building_sets = {
        urban
        trade
    }
    potential = {
        exists = owner
        owner = {
            OR = {
                has_civic = civic_machine_financial_investment
                has_civic = civic_hive_capital_creates_gods
            }
        }
    }
    allow = {
    }
    destroy_trigger = {
        exists = owner
        owner = {
            NOR = {
                has_civic = civic_machine_financial_investment
                has_civic = civic_hive_capital_creates_gods
            }
        }
    }
    convert_to = {
        building_commercial_zone
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }
    prerequisites = {
        "tech_interplanetary_commerce_gestalt"
    }
    show_tech_unlock_if = {
        exists = owner
        owner = {
            OR = {
                has_civic = civic_machine_financial_investment
                has_civic = civic_hive_capital_creates_gods
            }
        }
    }
    planet_modifier = {
        job_merchant_drone_add = 300
    }
    triggered_desc = {
        text = job_merchant_drone_effect_desc
    }
    upgrades = {
        "building_commercial_megaplex_gestalt"
    }
    ai_resource_production = {
        energy = 10
        trigger = {
            always = yes
        }
    }
    ai_resource_production = {
        energy = 25
        trigger = {
            OR = {
                num_unemployed >= 10
                num_assigned_jobs = {
                    job = servant
                    value >= 10
                }
            }
        }
    }
    ai_weight = {
        modifier = {
            factor = 10
            owner = { has_policy_flag = economic_stance_market }
        }
    }
}

#格式塔巨型商业中心
building_commercial_megaplex_gestalt = {
    icon = building_commercial_megaplex
    base_buildtime = @b2_time
    can_build = no
    category = trade

    building_sets = {
        urban
        trade
    }
    potential = {
        exists = owner
        owner = {
            OR = {
                has_civic = civic_machine_financial_investment
                has_civic = civic_hive_capital_creates_gods
            }
        }
        has_building = building_commercial_zone_gestalt
    }
    destroy_trigger = {
        exists = owner
        owner = {
            NOR = {
                has_civic = civic_machine_financial_investment
                has_civic = civic_hive_capital_creates_gods
            }
        }
    }
    convert_to = {
        building_commercial_megaplex
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            rare_crystals = @b2_rare_upkeep
        }
    }
    prerequisites = {
        "tech_interstellar_economics_gestalt"
    }
    show_tech_unlock_if = {
        exists = owner
        owner = {
            OR = {
                has_civic = civic_machine_financial_investment
                has_civic = civic_hive_capital_creates_gods
            }
        }
    }
    planet_modifier = {
        job_merchant_drone_add = 600
    }
    triggered_desc = {
        text = job_merchant_drone_effect_desc
    }
    ai_resource_production = {
        energy = 20
        trigger = {
            always = yes
        }
    }
    ai_resource_production = {
        energy = 50
        trigger = {
            OR = {
                num_unemployed >= 10
                num_assigned_jobs = {
                    job = servant
                    value >= 10
                }
            }
        }
    }
    ai_weight = {
        modifier = {
            factor = 15
            owner = { has_policy_flag = economic_stance_market }
        }
    }
}

#联合餐饮服务中心
building_united_catering_service_center = {
    base_buildtime = @b1_time
    base_cap_amount = 1
    icon = building_sacred_grove

    category = pop_assembly

    building_sets = {
        government
        urban
        entertainment
        resort
        food
    }

    potential = {
        NOT = { has_modifier = slave_colony }
        exists = owner
        owner = { has_valid_civic = civic_gourmet_journey }
    }

    destroy_trigger = {
        has_modifier = slave_colony
        is_gestalt = yes
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    planet_modifier = {
        planet_amenities_mult = 0.33
        job_chef_add = 100
        job_chef_per_pop = 0.01
    }

    inline_script = {
        script = jobs/farmers_add
        AMOUNT = @base_rural_district_jobs
    }

    country_modifier = {
        planet_stability_mult = 0.05
    }

    show_tech_unlock_if = {
        owner = { has_valid_civic = civic_gourmet_journey }
    }

    ai_resource_production = {
        food = 50
        unity = 50
        influence = 1
    }
}

#外星美食街
holding_alien_food_street = {
    base_buildtime = @b2_time
    owner_type = subject_holding
    icon = building_sacred_grove
    planet_limit = 1

    category = amenity

    potential = {
        exists = owner.overlord
        owner.overlord = { has_valid_civic = civic_gourmet_journey }
    }

    allow = {
        exists = owner
        owner = {
            is_gestalt = no
        }
    }

    planet_modifier = {
        job_chef_add = 200
        job_chef_per_pop = 0.01
    }

    planet_modifier = {
        monthly_loyalty = 1
    }

    resources = {
        category = planet_holdings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = { is_lithoid_empire = yes }
            }
            minerals = 10
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    OR = {
                        is_machine_empire = yes
                        is_mechanical_empire = yes
                    }
                }
            }
            energy = 10
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_lithoid = no
                    is_machine_empire = no
                    is_mechanical_empire = no
                }
            }
            food = 10
        }
    }
}

#外星美食街（企业）
building_alien_food_street = {
    base_buildtime = @b2_time
    owner_type = corporate
    icon = building_sacred_grove
    planet_limit = 1

    category = amenity

    potential = {
        has_branch_office = yes
        branch_office_owner = {
            has_valid_civic = civic_gourmet_journey
        }
        NOT = { has_modifier = slave_colony }
    }

    planet_modifier = {
        job_chef_add = 200
    }

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_criminal_syndicate = yes
                NOT = { is_legit_or_legal_criminal = yes }
            }
        }
        planet_crime_add = 25
        mult = branch_office_owner.value:scripted_modifier_mult|MODIFIER|branch_office_holding_crime_mult|
    }

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_criminal_syndicate = yes
                is_legit_or_legal_criminal = yes
            }
        }
        planet_crime_floor_add = 5
    }

    custom_tooltip = branch_office_building_trade_bonus

    planet_modifier = {
        planet_farmers_trade_produces_add = 0.5
    }

    resources = {
        category = planet_holdings
        produces = {
            trade = 1
            mult = value:branch_office_value_for_buildings
        }
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = { is_lithoid_empire = yes }
            }
            minerals = 10
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    OR = {
                        is_machine_empire = yes
                        is_mechanical_empire = yes
                    }
                }
            }
            energy = 10
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_lithoid = no
                    is_machine_empire = no
                    is_mechanical_empire = no
                }
            }
            food = 10
        }
    }
}

#宇宙尽头的餐馆
building_ethic_akx_worm_4 = {
    base_buildtime = 900
    empire_limit = {
        base = 1
    }
    can_demolish = no
    can_be_ruined = no
    can_be_disabled = no

    building_sets = {
        government
        urban
        entertainment
        resort
    }
    potential = {
        NOR = {
            has_modifier = slave_colony
            has_planet_flag = planetary_station
        }
        exists = owner
        owner = {
            has_technology = tech_akx_worm_1
            has_valid_civic = civic_gourmet_journey
        }
    }
    planet_modifier = {
        planet_amenities_mult = 1
        pop_happiness = 1
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = 10000
        }
        upkeep = {
            energy = @b3_upkeep
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = { is_lithoid_empire = yes }
            }
            minerals = 20
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    OR = {
                        is_machine_empire = yes
                        is_mechanical_empire = yes
                    }
                }
            }
            energy = 20
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_lithoid = no
                    is_machine_empire = no
                    is_mechanical_empire = no
                }
            }
            food = 20
        }
    }
}

#死亡竞技场
building_colliseum = {
    base_buildtime = 480
    base_cap_amount = 1
    category = amenity
    building_sets = {
        government
        urban
        entertainment
        resort
    }
    potential = {
        exists = owner
        owner = {
            has_valid_civic = civic_reeducated_labor
            not = { has_ethic = ethic_fanatic_pacifist }
        }
    }
    allow = {
        has_upgraded_capital = yes
        OR = {
            has_building = building_slave_processing
            has_building = building_plentiful_traditions_advanced_slave_processing
        }
    }
    destroy_trigger = {
        exists = owner
        OR = {
            NOR = {
                has_building = building_slave_processing
                has_building = building_plentiful_traditions_advanced_slave_processing
            }
            owner = {
                not = {
                    has_valid_civic = civic_reeducated_labor
                }
            }
        }
    }
    planet_modifier = {
        job_gladiator_add = 200
        planet_housing_add = 100
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_valid_civic = civic_warrior_culture
            }
        }
        modifier = {
            job_gladiator_add = 200
        }
    }
    resources = {
        category = planet_buildings
        produces = {
            trade = 400
        }
        cost = {
            minerals = 500
            alloys = 50
        }
        upkeep = {
            energy = 2
        }
    }
    triggered_desc = {
        text = job_gladiator_effect_desc
    }
    on_built = {
        planet = {
            owner = {
                set_timed_country_flag = {
                    flag = buildings_new_alloys_building
                    days = 480
                }
            }
        }
    }
}

#法师塔
building_mage_tower_1 = {
    base_buildtime = @b1_time

    exempt_from_ai_planet_specialization = no

    category = research

    building_sets = {
        research
        physics
        society
        engineering
    }

    potential = {
        NOR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        OR = {
            owner = { has_origin = origin_wizarding_world }
            owner = { has_civic = civic_dark_consortium }
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
    }

    convert_to = {
        building_research_lab_1
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }

        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 10
        }
    }

    planet_modifier = {
        job_magician_add = 100
        job_magical_apprentice_add = 200
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { has_origin = origin_wizarding_world }
            exists = planet
            planet = { NOT = { has_modifier = ley_rift } }
        }
        text = has_ley_rift
    }

    triggered_desc = {
        text = job_magician_effect_desc
    }

    triggered_desc = {
        text = job_magical_apprentice_effect_desc
    }

    upgrades = {
        "building_mage_tower_2"
    }

    prerequisites = {
        "tech_basic_science_lab_1"
    }
    ai_resource_production = {
        physics_research = 20
        society_research = 20
        engineering_research = 20
    }
}

#知识之塔
building_mage_tower_2 = {
    base_buildtime = @b2_time
    can_build = no

    category = research

    building_sets = {
        research
        physics
        society
        engineering
    }

    allow = {
        has_upgraded_capital = yes
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
    }

    convert_to = {
        building_research_lab_2
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            exotic_gases = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            exotic_gases = @b2_rare_upkeep
        }

        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 20
        }
    }

    planet_modifier = {
        job_magician_add = 200
        job_magical_apprentice_add = 400
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { has_origin = origin_wizarding_world }
            exists = planet
            planet = { NOT = { has_modifier = ley_rift } }
        }
        text = has_ley_rift
    }

    triggered_desc = {
        text = job_magician_effect_desc
    }

    triggered_desc = {
        text = job_magical_apprentice_effect_desc
    }

    upgrades = {
        "building_mage_tower_3"
    }

    prerequisites = {
        "tech_basic_science_lab_2"
    }
    ai_resource_production = {
        physics_research = 40
        society_research = 40
        engineering_research = 40
    }
}

#奥秘之塔
building_mage_tower_3 = {
    base_buildtime = @b3_time
    can_build = no

    category = research

    building_sets = {
        research
        physics
        society
        engineering
    }

    allow = {
        has_major_upgraded_capital = yes
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
    }

    convert_to = {
        building_research_lab_3
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                NOR = {
                    has_valid_civic = civic_anarchism
                    is_community_society = yes
                }
            }
        }
        job_legendary_mage_add = 1
        job_magician_add = 300
        job_magical_apprentice_add = 600
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                OR = {
                    has_valid_civic = civic_anarchism
                    is_community_society = yes
                }
            }
        }
        job_magician_add = 500
        job_magical_apprentice_add = 1000
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { has_origin = origin_wizarding_world }
            exists = planet
            planet = { NOT = { has_modifier = ley_rift } }
        }
        text = has_ley_rift
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = {
                OR = {
                    has_valid_civic = civic_anarchism
                    is_community_society = yes
                }
            }
        }
        text = job_legendary_mage_effect_desc
    }

    triggered_desc = {
        text = job_magician_effect_desc
    }

    triggered_desc = {
        text = job_magical_apprentice_effect_desc
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_regular_empire = yes
                is_galactic_community_member = yes
            }
            is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
            has_modifier = pm_extradimensional_experimentation
        }
        modifier = {
            job_dimensional_portal_researcher_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_gestalt = yes
                is_galactic_community_member = yes
            }
            is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
            has_modifier = pm_extradimensional_experimentation
        }
        modifier = {
            job_dimensional_portal_researcher_gestalt_add = 100
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
            exotic_gases = @b3_rare_cost
        }
        upkeep = {
            energy = @b3_upkeep
            exotic_gases = @b3_rare_upkeep
        }
        upkeep = {
            trigger = {
                owner = {
                    is_galactic_community_member = yes
                }
                is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
                planet = {
                    has_modifier = pm_extradimensional_experimentation
                }
            }
            sr_zro = 1
        }

        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 3
        }
    }

    prerequisites = {
        "tech_basic_science_lab_3"
    }
    ai_resource_production = {
        physics_research = 60
        society_research = 60
        engineering_research = 60
    }
}

#法师学院
building_school_of_magic = {
    base_buildtime = @b2_time
    base_cap_amount = 1
    category = research

    building_sets = {
        city
        research
        physics
        society
        engineering
    }

    potential = {
        NOR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            OR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
    }
    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
    }
    convert_to = {
        building_supercomputer
        building_institute
    }
    allow = {
        has_major_upgraded_capital = yes
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            exotic_gases = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            exotic_gases = @b2_rare_upkeep
        }

        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 50
        }
    }
    country_modifier = {
        scientist_exp_gain = 0.05
    }
    planet_modifier = {
        planet_researchers_produces_mult = 0.15
        job_legendary_mage_add = 3
        job_magician_add = 300
        job_magical_apprentice_add = 900
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_valid_civic = civic_innovative_economy
            }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.05
        }
    }
    prerequisites = {
        "tech_global_research_initiative"
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { has_origin = origin_wizarding_world }
            exists = planet
            planet = { NOT = { has_modifier = ley_rift } }
        }
        text = has_ley_rift
    }
    triggered_desc = {
        trigger = {
            exists = owner
            owner = {
                OR = {
                    has_valid_civic = civic_anarchism
                    is_community_society = yes
                }
            }
        }
        text = job_legendary_mage_effect_desc
    }

    triggered_desc = {
        text = job_magician_effect_desc
    }

    triggered_desc = {
        text = job_magical_apprentice_effect_desc
    }
    triggered_desc = {
        text = building_photon_computing_center_1_effect
    }
    triggered_desc = {
        text = building_photon_computing_center_2_effect
    }
    show_tech_unlock_if = {
        is_regular_empire = yes
    }

    inline_script = {
        script = districts/ai_research_extra_weighting
        AMOUNT = 500
    }
}

#机械修道院
building_mecha_monastery = {
    base_buildtime = 360
    base_cap_amount = 3
    category = pop_assembly
    building_sets = {
        government
        urban
        unity
    }
    potential = {
        owner = {
            has_valid_civic = civic_machine_soul_servant
        }
        NOR = {
            has_modifier = slave_colony
            has_planet_flag = planetary_station
        }
    }
    allow = {
        has_upgraded_capital = yes
    }
    destroy_trigger = {
        exists = owner
        OR = {
            owner = {
                NOT = {
                    owner = {
                        has_valid_civic = civic_machine_soul_servant
                    }
                }
            }
        }
    }
    convert_to = {
        building_robot_assembly_plant
    }
    planet_modifier = {
        job_techno_priest_add = 200
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = 500
        }
        upkeep = {
            energy = 2
        }
    }
    triggered_desc = {
        text = job_techno_priest_effect_desc
    }
    ai_resource_production = {
        unity = 15
        engineering_research = 10
    }
}

#机械圣堂
building_mechanical_sanctuary = {
    base_buildtime = @b1_time
    category = unity

    building_sets = {
        government
        urban
        entertainment
        resort
    }
    potential = {
        owner = {
            has_origin = origin_machine_cult
        }
        NOT = {
            has_modifier = slave_colony
        }
    }
    destroy_trigger = {
        exists = owner
        OR = {
            owner = {
                NOT = {
                    owner = {
                        has_origin = origin_machine_cult
                    }
                }
            }
        }
    }
    planet_modifier = {
        job_machine_soul_add = 1000
    }
    #三级首都
    triggered_planet_modifier = {
        potential = {
            has_major_upgraded_capital = yes
        }
        modifier = {
            job_machine_soul_add = 500
        }
    }
    #四级首都
    triggered_planet_modifier = {
        potential = {
            has_fully_upgraded_capital = yes
        }
        modifier = {
            job_machine_soul_add = 500
        }
    }
    #帝国首都
    triggered_planet_modifier = {
        potential = {
            OR = {
                has_building = building_imperial_capital
                has_building = building_hab_imperial_capital
            }
        }
        modifier = {
            job_machine_soul_add = 1000
        }
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = 500
        }
        upkeep = {
            energy = 2
        }
    }
    triggered_desc = {
        text = job_machine_soul_effect_desc
    }
    ai_resource_production = {
        unity = 50
    }
}

#异星风俗街
building_alien_custom_street = {
    base_buildtime = @b2_time

    owner_type = corporate

    icon = building_spawning_pool

    potential = {
        has_branch_office = yes
        branch_office_owner = {
            is_servitor_empire = no
            has_valid_civic = civic_liberty_of_libido
        }
    }

    planet_modifier = {
        pop_happiness = 0.05
        logistic_growth_mult = 0.25
        pop_amenities_usage_mult = 0.25
    }

    resources = {
        category = planet_branch_office_buildings
        produces = {
            trade = 10
            mult = value:branch_office_value_for_buildings
        }
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = 5
        }
    }

    ai_weight = {
        weight = 250
    }
}

#器械繁殖厂
building_equipment_breeding_plant = {
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = pop_assembly
    icon = building_spawning_pool

    building_sets = {
        government
        urban
        entertainment
        resort
    }
    potential = {
        exists = owner
        owner = {
            OR = {
                is_regular_empire = yes
            }
            has_valid_civic = civic_libido_equipment
        }
    }
    allow = {
        has_upgraded_capital = yes
    }
    destroy_trigger = {
        exists = owner
        owner = {
            NOT = {
                has_valid_civic = civic_libido_equipment
            }
        }
    }
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_regular_empire = yes
            }
        }
        modifier = {
            job_tentacle_seedbed_add = 200
        }
    }
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_gestalt = yes
            }
        }
        modifier = {
            job_tentacle_seedbed_drone_add = 200
        }
    }
    #三级首都
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_regular_empire = yes
            }
            has_major_upgraded_capital = yes
        }
        modifier = {
            job_tentacle_seedbed_add = 100
        }
    }
    #四级首都
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_regular_empire = yes
            }
            has_fully_upgraded_capital = yes
        }
        modifier = {
            job_tentacle_seedbed_add = 100
        }
    }
    #帝国首都
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_regular_empire = yes
            }
            OR = {
                has_building = building_imperial_capital
                has_building = building_hab_imperial_capital
            }
        }
        modifier = {
            job_tentacle_seedbed_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_gestalt = yes
            }
            has_building = building_imperial_hive_capital
        }
        modifier = {
            job_tentacle_seedbed_drone_add = 100
        }
    }
    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }
    triggered_desc = {
        text = job_tentacle_seedbed_effect_desc
    }
    triggered_desc = {
        trigger = {
            OR = {
                has_building = building_robot_assembly_plant
                AND = {
                    exists = assembling_species
                    assembling_species = {
                        is_robotic_species = yes
                    }
                }
            }
        }
        text = tooltip_organic_and_artificial_assembly_warning
    }
}

#居住站住宅模块
building_habitat_housing = {
    base_buildtime = @b1_time
    icon = building_residence

    category = amenity

    building_sets = {
        government
        urban
        habitat_urban
        entertainment
        resort
        generator
        farming
        habitat_mining
        mining
    }

    potential = {
        exists = planet
        planet = { is_planet_class = pc_habitat }
        exists = owner
        owner = {
            is_void_dweller_empire = no
        }
    }

    destroy_trigger = {
        exists = owner
        OR = {
            AND = {
                owner = { is_ai = yes }
                free_building_slots = 0
                free_jobs < 100
                free_housing > 1000
            }
            owner = {
                is_void_dweller_empire = yes
            }
        }
    }

    convert_to = {
        building_drone_storage
        building_hive_warren
        building_luxury_residence
        building_communal_housing
    }

    planet_modifier = {
        planet_housing_add = 1000
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    upgrades = {
        "building_habitat_housing_large"
    }
}

#居住站公寓
building_habitat_housing_large = {
    base_buildtime = @b2_time
    can_build = no
    icon = building_luxury_residence

    category = amenity

    building_sets = {
        government
        urban
        habitat_urban
        entertainment
        resort
        generator
        farming
        habitat_mining
        mining
    }

    potential = {
        has_building = building_habitat_housing
        exists = planet
        planet = { is_planet_class = pc_habitat }
        exists = owner
        owner = {
            is_void_dweller_empire = no
        }
    }

    allow = {
        has_upgraded_capital = yes
    }

    destroy_trigger = {
        exists = owner
        owner = {
            is_void_dweller_empire = yes
        }
    }

    show_tech_unlock_if = {
        exists = owner
        owner = {
            is_void_dweller_empire = no
        }
    }

    convert_to = {
        building_drone_megastorage
        building_expanded_warren
        building_paradise_dome
        building_communal_housing_large
    }

    planet_modifier = {
        planet_housing_add = 2000
        planet_amenities_add = 2000
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = 3
            rare_crystals = @b2_rare_upkeep
        }
    }

    prerequisites = {
        "tech_habitat_2"
    }
}

#居住站生态住宅
building_habitat_housing_large_max = {
    base_buildtime = @b3_time
    can_build = no
    icon = building_paradise_dome

    category = amenity

    building_sets = {
        government
        urban
        habitat_urban
        entertainment
        resort
        generator
        farming
        habitat_mining
        mining
    }

    potential = {
        has_building = building_habitat_housing_large
        exists = planet
        planet = { is_planet_class = pc_habitat }
        exists = owner
        owner = {
            is_void_dweller_empire = no
        }
    }

    allow = {
        has_upgraded_capital = yes
    }

    destroy_trigger = {
        exists = owner
        owner = {
            is_void_dweller_empire = yes
        }
    }

    show_tech_unlock_if = {
        exists = owner
        owner = {
            is_void_dweller_empire = no
        }
    }

    convert_to = {
        building_drone_megastorage
        building_expanded_warren
        building_paradise_dome
        building_communal_housing_large
    }

    planet_modifier = {
        planet_housing_add = 4000
        planet_amenities_add = 4000
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
            rare_crystals = @b3_rare_cost
        }
        upkeep = {
            energy = 3
            rare_crystals = @b3_rare_upkeep
        }
    }

    prerequisites = {
        "tech_habitat_3"
    }
}

#非政府政府大楼
building_NGO_building = {
    base_buildtime = @b2_time
    icon = building_xeno_zoo

    owner_type = corporate

    category = resource

    potential = {
        has_branch_office = yes
        branch_office_owner = {
            has_valid_civic = civic_NGO
        }
    }

    on_built = {
    }

    on_destroy = {
    }

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_criminal_syndicate = yes
                NOT = { is_legit_or_legal_criminal = yes }
            }
        }
        planet_crime_add = 25
        mult = branch_office_owner.value:scripted_modifier_mult|MODIFIER|branch_office_holding_crime_mult|
    }

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_criminal_syndicate = yes
                is_legit_or_legal_criminal = yes
            }
        }
        planet_crime_floor_add = 5
    }

    custom_tooltip = branch_office_building_trade_bonus

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_scientific_socialism = no
            }
        }
        job_criminal_add = 250
        planet_stability_add = -10
    }

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_scientific_socialism = yes
            }
            planet.owner = {
                is_scientific_socialism = no
            }
        }
        job_guerrilla_add = 250
        planet_stability_add = -10
    }

    triggered_planet_modifier = {
        potential = {
            branch_office_owner = {
                is_scientific_socialism = no
            }
            planet.owner = {
                is_scientific_socialism = yes
            }
        }
        job_labour_hero_add = 250
        planet_stability_add = 5
    }

    resources = {
        category = planet_branch_office_buildings
        cost = {
            influence = 25
            minerals = @b3_minerals
        }
        cost = {
            trigger = {
                owner = {
                    has_authority = auth_corporate
                }
            }
            influence = 25
        }
        produces = {
            trade = 10
            mult = value:branch_office_value_for_buildings
        }
        upkeep = {
            consumer_goods = 1
        }
    }

    ai_weight = {
        weight = 120
    }
}