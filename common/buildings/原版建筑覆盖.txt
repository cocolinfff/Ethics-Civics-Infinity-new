#星球网络节点
building_automation_1 = {
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = pop_assembly

    building_sets = {
        automation
    }

    potential = {
        always = no
    }

    upgrades = {
        building_automation_2
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        exists = owner
        owner = { is_wilderness_empire = yes }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = @b3_upkeep
            mult = value:count_any_districts
        }
        upkeep = {
            energy = @b3_upkeep
            mult = value:count_any_building
        }
    }

    prerequisites = {
        tech_auto_buildings
    }

    show_tech_unlock_if = {
        is_wilderness_empire = no
    }

    triggered_desc = {
        text = automation_tooltip
    }
}
building_automation_city_1 = {
    icon = building_automation_1
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = pop_assembly

    building_sets = {
        government
        urban
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    upgrades = {
        building_automation_city_2
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = @b4_upkeep
            mult = value:city_districts_value
        }
    }

    prerequisites = {
        tech_auto_buildings
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_city_tooltip
    }
}
building_automation_generator_1 = {
    icon = building_automation_1
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = pop_assembly

    building_sets = {
        generator
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    upgrades = {
        building_automation_generator_2
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = @b3_upkeep
            mult = value:generator_districts_value
        }
    }

    prerequisites = {
        tech_auto_buildings
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_tooltip
    }
}
building_automation_farming_1 = {
    icon = building_automation_1
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = pop_assembly

    building_sets = {
        farming
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    upgrades = {
        building_automation_farming_2
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = @b3_upkeep
            mult = value:farming_districts_value
        }
    }

    prerequisites = {
        tech_auto_buildings
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_tooltip
    }
}
building_automation_mining_1 = {
    icon = building_automation_1
    base_buildtime = @b1_time
    base_cap_amount = 1
    category = pop_assembly

    building_sets = {
        mining
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    upgrades = {
        building_automation_mining_2
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = @b3_upkeep
            mult = value:mining_districts_value
        }
    }

    prerequisites = {
        tech_auto_buildings
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_tooltip
    }
}

#星球管理中枢
building_automation_2 = {
    base_buildtime = @b2_time
    base_cap_amount = 1
    can_build = no
    category = pop_assembly

    building_sets = {
        government
        urban
        farming
        mining
        generator
    }

    potential = {
        always = no
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {}

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.5
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
        }
        upkeep = {
            energy = @b4_upkeep
            mult = value:count_any_districts
        }
        upkeep = {
            energy = @b4_upkeep
            mult = value:count_any_building
        }
    }

    prerequisites = {
        tech_adv_auto_buildings_1
    }

    show_tech_unlock_if = {
        is_wilderness_empire = no
    }

    triggered_desc = {
        text = automation_2_tooltip
    }
}
building_automation_city_2 = {
    icon = building_automation_2
    base_buildtime = @b2_time
    base_cap_amount = 1
    can_build = no
    category = pop_assembly

    building_sets = {
        government
        urban
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.5
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
        }
        upkeep = {
            energy = @b5_upkeep
            mult = value:city_districts_value
        }
    }

    prerequisites = {
        tech_adv_auto_buildings_1
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_city_2_tooltip
    }
}
building_automation_generator_2 = {
    icon = building_automation_2
    base_buildtime = @b2_time
    base_cap_amount = 1
    can_build = no
    category = pop_assembly

    building_sets = {
        generator
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.5
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
        }
        upkeep = {
            energy = @b4_upkeep
            mult = value:generator_districts_value
        }
    }

    prerequisites = {
        tech_adv_auto_buildings_1
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_2_tooltip
    }
}
building_automation_farming_2 = {
    icon = building_automation_2
    base_buildtime = @b2_time
    base_cap_amount = 1
    can_build = no
    category = pop_assembly

    building_sets = {
        farming
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.5
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
        }
        upkeep = {
            energy = @b4_upkeep
            mult = value:farming_districts_value
        }
    }

    prerequisites = {
        tech_adv_auto_buildings_1
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_2_tooltip
    }
}
building_automation_mining_2 = {
    icon = building_automation_2
    base_buildtime = @b2_time
    base_cap_amount = 1
    can_build = no
    category = pop_assembly

    building_sets = {
        mining
    }

    potential = {
        owner = { is_wilderness_empire = no }
    }

    allow = {
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                NAND = {
                    free_district_slots = 0
                    free_building_slots <= 1
                    free_housing <= 0
                    free_jobs <= 0
                }
            }
        }
    }

    destroy_trigger = {
        owner = {
            is_wilderness_empire = yes
        }
    }

    planet_modifier = {
        district_automated_workforce = 0.25
    }

    triggered_planet_modifier = {
        potential = { 
            exists = owner
            owner = { has_valid_civic = civic_OGAS }
        }
        district_automated_workforce = 0.5
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_future_industry }
        }
        district_automated_workforce = 0.25
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
        }
        upkeep = {
            energy = @b4_upkeep
            mult = value:mining_districts_value
        }
    }

    prerequisites = {
        tech_adv_auto_buildings_1
    }

    show_tech_unlock_if = {
        always = no
    }

    triggered_desc = {
        text = automation_2_tooltip
    }
}

#奢侈住所
building_luxury_residence = {
    base_buildtime = @b1_time
    category = amenity

    building_sets = {
        government
        urban
        entertainment
        resort
    }

    potential = {
        OR = {
            NOT = { is_planet_class = pc_habitat }
            AND = {
                exists = owner
                owner = {
                    is_void_dweller_empire = yes
                }
            }
        }
        NOR = {
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            is_regular_empire = yes
            is_egalitarian = no
        }
        NOT = { has_building = building_low_tech_capital }
    }

    destroy_trigger = {
        exists = owner
        OR = {
            AND = {
                free_building_slots = 0
                free_jobs < 100
                free_housing > 1000
                owner = {
                    is_ai = yes
                }
            }
            owner = { is_regular_empire = no }
            owner = { is_egalitarian = yes }
            has_modifier = slave_colony
        }
    }

    convert_to = {
        building_drone_storage
        building_hive_warren
        building_communal_housing
    }

    planet_modifier = {
        planet_housing_add = 1500
        planet_amenities_add = 2500
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    upgrades = {
        "building_paradise_dome"
    }
}

#乐土园
building_paradise_dome = {
    base_buildtime = @b2_time
    can_build = no

    category = amenity

    building_sets = {
        government
        urban
        entertainment
        resort
    }

    potential = {
        has_building = building_luxury_residence
        OR = {
            NOT = { is_planet_class = pc_habitat }
            AND = {
                exists = owner
                owner = {
                    is_void_dweller_empire = yes
                }
            }
        }
        NOR = {
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
    }

    allow = {
        has_upgraded_capital = yes
    }

    destroy_trigger = {
        exists = owner
        OR = {
            owner = { is_regular_empire = no }
            owner = { is_egalitarian = yes }
            has_modifier = slave_colony
        }
    }

    convert_to = {
        building_organic_paradise
        building_drone_megastorage
        building_expanded_warren
        building_communal_housing_large
    }

    planet_modifier = {
        planet_housing_add = 3000
        planet_amenities_add = 5000
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = 3
            rare_crystals = @b2_rare_upkeep
        }
    }

    prerequisites = {
        "tech_paradise_dome"
    }

    show_tech_unlock_if = {
        owner = {
            is_regular_empire = yes
            NOT = { has_valid_civic = civic_shared_burden }
        }
    }
}

#公共住房
building_communal_housing = {
    base_buildtime = @b1_time
    icon = building_residence

    category = amenity

    building_sets = {
        government
        urban
        entertainment
        resort
    }

    potential = {
        OR = {
            NOT = { is_planet_class = pc_habitat }
            AND = {
                exists = owner
                owner = {
                    is_void_dweller_empire = yes
                }
            }
        }
        NOR = {
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            is_regular_empire = yes
            is_egalitarian = yes
        }
    }

    destroy_trigger = {
        exists = owner
        OR = {
            AND = {
                owner = { is_ai = yes }
                free_building_slots = 0
                free_jobs < 100
                free_housing > 1000
            }
            has_modifier = slave_colony
            owner = {
                is_regular_empire = no
            }
        }
    }

    convert_to = {
        building_drone_storage
        building_hive_warren
        building_luxury_residence
    }

    planet_modifier = {
        planet_housing_add = 2000
        planet_amenities_add = 3000
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    upgrades = {
        "building_communal_housing_large"
    }
}

#乌托邦公共住房
building_communal_housing_large = {
    base_buildtime = @b2_time
    can_build = no
    icon = building_paradise_dome

    category = amenity

    building_sets = {
        government
        urban
        entertainment
        resort
    }

    potential = {
        has_building = building_communal_housing
        owner = {
            is_regular_empire = yes
            is_egalitarian = yes
        }

        OR = {
            NOT = { is_planet_class = pc_habitat }
            AND = {
                exists = owner
                owner = {
                    is_void_dweller_empire = yes
                }
            }
        }
        NOR = {
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
    }

    allow = {
        has_upgraded_capital = yes
    }

    destroy_trigger = {
        exists = owner
        OR = {
            has_modifier = slave_colony
            owner = {
                is_egalitarian = no
            }
        }
    }

    show_tech_unlock_if = {
        owner = {
            is_regular_empire = yes
            has_valid_civic = civic_shared_burden
        }
    }

    convert_to = {
        building_drone_megastorage
        building_expanded_warren
        building_paradise_dome
    }

    planet_modifier = {
        planet_housing_add = 4000
        planet_amenities_add = 6000
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_active_tradition = tr_domination_imperious_architecture
            }
        }
        modifier = {
            planet_housing_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_real_estate_market_country = yes
            }
        }
        modifier = {
            job_bureaucrat_add = 100
            planet_crime_mult = 0.05
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = 3
            rare_crystals = @b2_rare_upkeep
        }
    }

    prerequisites = {
        "tech_paradise_dome"
    }
}

#资源仓库
building_resource_silo = {
    base_buildtime = 180

    category = resource

    potential = {
        NOR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = crucible_colony
        }
    }

    allow = {
        exists = owner
        hidden_trigger = {
            OR = {
                owner = { is_ai = no }
                AND = {
                    NOT = { has_building = building_resource_silo }
                    OR = {
                        owner = {
                            is_machine_empire = yes
                            has_active_tradition = tr_domination_modular_depot
                        }
                        is_active_resolution = "resolution_greatergood_balance_in_the_middle"
                        is_active_resolution = "resolution_greatergood_universal_prosperity_mandate"
                        owner = {
                            has_ascension_perk = ap_arcology_project
                            NOT = { has_technology = tech_mega_engineering }
                        }
                    }
                }
            }
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_clerk_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_maintenance_drone_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                OR = {
                    has_civic = civic_extremely_efficient_storage
                    has_civic = civic_extremely_efficient_storage_corporate
                }
            }
        }
        modifier = {
            job_soldier_add = 50
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                OR = {
                    has_civic = civic_hive_extremely_efficient_storage
                    has_civic = civic_machine_extremely_efficient_storage
                }
            }
        }
        modifier = {
            job_warrior_drone_add = 50
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = 200
        }
        upkeep = {
            energy = 1
        }
    }

    country_modifier = {
        country_resource_max_add = 5000
    }

    triggered_country_modifier = {
        potential = {
            exists = owner
            owner = {
                has_technology = tech_construction_templates
            }
        }
        country_resource_max_add = 5000
    }

    triggered_country_modifier = {
        potential = {
            exists = owner
            owner = {
                is_extremely_efficient_storage_country = yes
            }
        }
        modifier = {
            country_resource_max_add = 3000
        }
    }

    prerequisites = {
        "tech_basic_industry"
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        text = job_maintenance_drone_effect_desc
    }
    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_gestalt = no }
        }
        text = job_clerk_effect_desc
    }
}

#研究实验室
building_research_lab_1 = {
    can_build = yes
    base_buildtime = @b1_time
    exempt_from_ai_planet_specialization = no

    category = research

    building_sets = {
        research
        physics
        society
        engineering
    }

    potential = {
        NOR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            is_wilderness_empire = no
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
        is_special_colony_type = no
    }

    allow = {
    }

    ai_weight_coefficient = 0

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
            has_origin = origin_wizarding_world
            has_civic = civic_dark_consortium
        }
    }

    convert_to = {
        building_mage_tower_1
    }

    inline_script = {
        script = jobs/researchers_add
        AMOUNT = @building_static_jobs_3
        LARGE_AMOUNT = @building_static_jobs
    }

    resources = {
        category = planet_buildings
        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 10
        }
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }

    prerequisites = {
        "tech_basic_science_lab_1"
    }

    upgrades = {
        "building_research_lab_2"
    }
}

#研究大楼
building_research_lab_2 = {
    base_buildtime = @b2_time
    can_build = no
    category = research

    building_sets = {
        research
        physics
        society
        engineering
    }

    potential = {
        exists = owner
        owner = {
            is_wilderness_empire = no # see 'building_brain_node_3'
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
        is_special_colony_type = no
    }

    allow = {
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
            has_origin = origin_wizarding_world
            has_civic = civic_dark_consortium
        }
    }

    convert_to = {
        building_mage_tower_2
    }

    resources = {
        category = planet_buildings
        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 20
        }
        cost = {
            minerals = @b2_minerals
            exotic_gases = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            exotic_gases = @b2_rare_upkeep
        }
    }

    inline_script = {
        script = jobs/researchers_add
        AMOUNT = @building_static_jobs_high_3
        LARGE_AMOUNT = @building_static_jobs
    }

    prerequisites = {
        "tech_basic_science_lab_2"
    }

    show_tech_unlock_if = {
        is_wilderness_empire = no
    }
    upgrades = {
        "building_research_lab_3"
    }
}

#高级研究大楼
building_research_lab_3 = {
    base_buildtime = @b3_time
    category = research
    can_build = no
    building_sets = {
        research
        physics
        society
        engineering
    }

    potential = {
        exists = owner
        owner = {
            is_wilderness_empire = no # see 'building_brain_node_4'
            NOR = {
                has_origin = origin_wizarding_world
                has_civic = civic_dark_consortium
            }
        }
        is_special_colony_type = no
    }

    allow = {
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
            has_origin = origin_wizarding_world
            has_civic = civic_dark_consortium
        }
    }

    convert_to = {
        building_mage_tower_3
    }

    resources = {
        category = planet_buildings
        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 30
        }
        cost = {
            minerals = @b3_minerals
            exotic_gases = @b3_rare_cost
        }
        upkeep = {
            energy = @b3_upkeep
            exotic_gases = @b3_rare_upkeep
        }
        upkeep = {
            trigger = {
                owner = {
                    is_galactic_community_member = yes
                }
                is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
                planet = {
                    has_modifier = pm_extradimensional_experimentation
                }
            }
            sr_zro = 1
        }
    }

    inline_script = {
        script = jobs/researchers_add
        AMOUNT = @building_static_jobs_very_high_3
        LARGE_AMOUNT = @building_static_jobs
    }

    prerequisites = {
        "tech_basic_science_lab_3"
    }

    show_tech_unlock_if = {
        is_wilderness_empire = no
    }
}

#研究中心
building_institute = {
    base_buildtime = @b2_time
    base_cap_amount = 1
    category = research

    building_sets = {
        research
        physics
        society
        engineering
    }

    potential = {
        NOR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
        }
        exists = owner
        owner = {
            OR = {
                is_regular_empire = yes
                NOR = {
                    has_origin = origin_wizarding_world
                    has_civic = civic_dark_consortium
                }
            }
        }
    }

    destroy_trigger = {
        exists = owner
        OR = {
            has_modifier = resort_colony
            has_modifier = slave_colony
            has_modifier = penal_colony
            owner = {
                OR = {
                    is_regular_empire = no
                    has_origin = origin_wizarding_world
                    has_civic = civic_dark_consortium
                }
            }
        }
    }

    convert_to = {
        building_supercomputer
        building_school_of_magic
    }

    allow = {
    }

    resources = {
        category = planet_buildings
        produces = {
            trigger = {
                exists = owner
                owner = { has_valid_civic = civic_innovative_economy }
            }
            unity = 50
        }
        cost = {
            minerals = @b2_minerals
            exotic_gases = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            exotic_gases = @b2_rare_upkeep
        }
    }
    planet_modifier = {
        planet_researchers_produces_mult = 0.15
        job_physicist_add = 150
        job_biologist_add = 150
        job_engineer_add = 150
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_valid_civic = civic_innovative_economy
            }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.05
        }
    }

    prerequisites = {
        "tech_global_research_initiative"
    }
    triggered_desc = {
        text = building_photon_computing_center_1_effect
    }
    triggered_desc = {
        text = building_photon_computing_center_2_effect
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
    }

    inline_script = {
        script = districts/ai_research_extra_weighting
        AMOUNT = 500
    }
}

#行政办公楼
building_bureaucratic_1 = {
    can_build = yes
    base_buildtime = @b1_time
    exempt_from_ai_planet_specialization = no

    category = government

    building_sets = {
        government
        unity
    }

    potential = {
        exists = owner
        owner = {
            is_regular_empire = yes
            is_spiritualist = no
            has_make_spiritualist_perk = no
        }
        allow_bureaucratic_building = yes
    }

    destroy_trigger = {
        exists = owner
        allow_bureaucratic_building = no
        owner = {
            OR = {
                is_regular_empire = no
                is_spiritualist = yes
                has_make_spiritualist_perk = yes
            }
        }
    }

    allow = {
    }

    ai_weight_coefficient = 0

    convert_to = {
        building_temple
        building_hive_node
        building_uplink_node
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }

    inline_script = {
        script = jobs/unity_jobs_add
        AMOUNT = @building_static_jobs
    }

    prerequisites = {
        "tech_planetary_government"
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
        is_spiritualist = no
        has_make_spiritualist_perk = no
    }
}

#行政园区
building_bureaucratic_2 = {
    base_buildtime = @b2_time
    base_cap_amount = 1
    category = government

    building_sets = {
        government
        unity
    }

    potential = {
        exists = owner
        owner = {
            is_regular_empire = yes
            is_spiritualist = no
            has_make_spiritualist_perk = no
        }
        allow_bureaucratic_building = yes
    }

    allow = {
    }

    destroy_trigger = {
        exists = owner
        allow_bureaucratic_building = no
        owner = {
            OR = {
                is_regular_empire = no
                is_spiritualist = yes
                has_make_spiritualist_perk = yes
            }
        }
    }

    convert_to = {
        building_holotemple
        building_hive_cluster
        building_network_junction
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            rare_crystals = @b2_rare_upkeep
        }
    }

    planet_modifier = {
        planet_bureaucrats_upkeep_mult = -0.20
    }

    prerequisites = {
        "tech_colonial_bureaucracy"
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
        is_spiritualist = no
        has_make_spiritualist_perk = no
    }
}

#复合型行政区
building_bureaucratic_3 = {
    base_buildtime = @b3_time
    base_cap_amount = 1
    category = government

    building_sets = {
        government
        unity
    }

    potential = {
        exists = owner
        owner = {
            is_regular_empire = yes
            is_spiritualist = no
            has_make_spiritualist_perk = no
        }
        allow_bureaucratic_building = yes
    }

    allow = {
    }

    destroy_trigger = {
        exists = owner
        allow_bureaucratic_building = no
        owner = {
            OR = {
                is_regular_empire = no
                is_spiritualist = yes
                has_make_spiritualist_perk = yes
            }
        }
    }

    convert_to = {
        building_sacred_nexus
        building_hive_confluence
        building_system_conflux
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
            rare_crystals = @b3_rare_cost
        }
        upkeep = {
            energy = @b3_upkeep
            rare_crystals = @b3_rare_upkeep
        }
    }

    planet_modifier = {
        pop_bureaucrat_bonus_workforce_mult = 0.15
    }

    inline_script = buildings/job_high_priest_variants_add_saintly_hierarchy

    prerequisites = {
        "tech_galactic_bureaucracy"
    }

    show_tech_unlock_if = {
        is_regular_empire = yes
        is_spiritualist = no
        has_make_spiritualist_perk = no
    }
}

#寺庙
building_temple = {
    base_buildtime = @b1_time
    exempt_from_ai_planet_specialization = no

    category = unity

    building_sets = {
        unity
        government
    }

    potential = {
        exists = owner
        owner = {
            OR = {
                is_spiritualist = yes
                AND = {
                    is_gestalt = no
                    has_make_spiritualist_perk = yes
                }
            }
        }
        allow_bureaucratic_building = yes
    }

    destroy_trigger = {
        exists = owner
        allow_bureaucratic_building = no
        owner = {
            OR = {
                AND = {
                    is_spiritualist = no
                    has_make_spiritualist_perk = no
                }
                is_gestalt = yes
            }
        }
    }

    allow = {
    }

    ai_weight_coefficient = 0

    convert_to = {
        building_bureaucratic_1
        building_hive_node
        building_uplink_node
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }

    planet_modifier = {
        pop_ethic_spiritualist_attraction_mult = 0.05
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_spiritual_seekers }
        }
        modifier = {
            job_transcend_add = 50
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_crusader_spirit }
        }
        modifier = {
            job_templar_add = 50
        }
    }

    inline_script = {
        script = jobs/priests_add
        AMOUNT = @building_static_jobs
    }

    prerequisites = {
        "tech_cultural_heritage"
    }

    show_tech_unlock_if = {
        OR = {
            is_spiritualist = yes
            AND = {
                is_gestalt = no
                has_make_spiritualist_perk = yes
            }
        }
    }
}

#全息神殿
building_holotemple = {
    base_buildtime = @b2_time
    base_cap_amount = 1
    category = unity

    building_sets = {
        unity
        government
    }

    potential = {
        exists = owner
        owner = {
            OR = {
                is_spiritualist = yes
                AND = {
                    is_gestalt = no
                    has_make_spiritualist_perk = yes
                }
            }
        }
        allow_bureaucratic_building = yes
    }

    allow = {
    }

    destroy_trigger = {
        exists = owner
        owner = {
            OR = {
                AND = {
                    is_spiritualist = no
                    has_make_spiritualist_perk = no
                }
                is_gestalt = yes
            }
        }
        allow_bureaucratic_building = no
    }

    convert_to = {
        building_bureaucratic_2
        building_hive_cluster
        building_network_junction
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = @b2_upkeep
            rare_crystals = @b2_rare_upkeep
        }
    }

    planet_modifier = {
        pop_ethic_spiritualist_attraction_mult = 0.10
        planet_bureaucrats_upkeep_mult = -0.20
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_spiritual_seekers }
        }
        modifier = {
            job_transcend_add = 100
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_crusader_spirit }
        }
        modifier = {
            job_templar_add = 100
        }
    }

    prerequisites = {
        "tech_holographic_rituals"
    }

    show_tech_unlock_if = {
        OR = {
            is_spiritualist = yes
            AND = {
                is_gestalt = no
                has_make_spiritualist_perk = yes
            }
        }
    }
}

#神圣中枢
building_sacred_nexus = {
    base_buildtime = @b3_time
    base_cap_amount = 1
    category = unity

    building_sets = {
        unity
        government
    }

    potential = {
        exists = owner
        owner = {
            OR = {
                is_spiritualist = yes
                AND = {
                    is_gestalt = no
                    has_make_spiritualist_perk = yes
                }
            }
        }
        allow_bureaucratic_building = yes
    }

    allow = {
    }

    destroy_trigger = {
        exists = owner
        owner = {
            OR = {
                AND = {
                    is_spiritualist = no
                    has_make_spiritualist_perk = no
                }
                is_gestalt = yes
            }
        }
        allow_bureaucratic_building = no
    }

    convert_to = {
        building_bureaucratic_3
        building_hive_confluence
        building_system_conflux
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
            rare_crystals = @b3_rare_cost
        }
        upkeep = {
            energy = @b3_upkeep
            rare_crystals = @b3_rare_upkeep
        }
    }

    planet_modifier = {
        pop_ethic_spiritualist_attraction_mult = 0.15
        pop_bureaucrat_bonus_workforce_mult = 0.15
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_spiritual_seekers }
        }
        modifier = {
            job_transcend_add = 200
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_crusader_spirit }
        }
        modifier = {
            job_templar_add = 200
        }
    }


    prerequisites = {
        "tech_consecration_fields"
    }

    show_tech_unlock_if = {
        OR = {
            is_spiritualist = yes
            AND = {
                is_gestalt = no
                has_make_spiritualist_perk = yes
            }
        }
    }
}

#护林员小屋
building_ranger_lodge = {
    base_buildtime = @b1_time
    base_cap_amount = 1
    icon = holding_park_ranger_lodge

    category = research

    building_sets = {
        research
        society
        hydroponics
        farming
    }

    potential = {
        NOT = {	has_modifier = slave_colony	}
        owner = {
            is_regular_empire = yes
            OR = {
                is_environmentalist_country = yes
                has_valid_civic = civic_The_Druid_Way
            }
        }
        NOR = {
            is_planet_class = pc_city
            is_planet_class = pc_hive
            is_planet_class = pc_machine
            is_planet_class = pc_relic
        }
        is_artificial = no
    }

    allow = {
        custom_tooltip = {
            fail_text = no_free_district_for_ranger_lodge
            planet = {
                num_free_districts = {
                    type = any
                    value > 0
                }
            }
        }
    }

    destroy_trigger = {
        exists = owner
        OR = {
            owner = { is_regular_empire = no }
            has_modifier = slave_colony
            owner = { NOT = { has_valid_civic = civic_environmentalist } }
            is_planet_class = pc_city
            is_planet_class = pc_hive
            is_planet_class = pc_machine
            is_planet_class = pc_relic
        }
    }

    ai_resource_production = {
        unity = 2
        mult = value:natural_blocker_count
    }

    ai_resource_production = {
        unity = 1
        trigger = { owner_has_resolution = { RES = resolution_ecology_integrated_gardens } }
        mult = value:natural_blocker_count
    }

    ai_resource_production = {
        unity = 1
        trigger = { owner_has_resolution = { RES = resolution_ecology_environmental_control_board } }
        mult = value:natural_blocker_count
    }

    ai_resource_production = {
        unity = 1
        trigger = { owner_has_resolution = { RES = resolution_ecology_paradise_initiative } }
        mult = value:natural_blocker_count
    }

    planet_modifier = {
        job_biologist_add = 100 # 100 Rangers no matter what
        deposit_blockers_natural_unity_produces_add = 2
    }

    triggered_planet_modifier = {
        potential = {
            always = yes
        }
        job_biologist_add = 100 # +100 Rangers per natural blocker
        mult = value:natural_blocker_count
    }

    triggered_planet_modifier = {
        potential = {
            owner_has_resolution = { RES = resolution_ecology_paradise_initiative }
        }
        job_biologist_add = 100 # +100 Rangers per natural blocker if GalCom approves
        mult = value:natural_blocker_count
    }


    triggered_planet_modifier = {
        potential = { owner_has_resolution = { RES = resolution_ecology_integrated_gardens } }
        deposit_blockers_natural_unity_produces_add = 1
    }

    triggered_planet_modifier = {
        potential = { owner_has_resolution = { RES = resolution_ecology_environmental_control_board } }
        deposit_blockers_natural_unity_produces_add = 2
    }

    triggered_planet_modifier = {
        potential = { owner_has_resolution = { RES = resolution_ecology_paradise_initiative } }
        deposit_blockers_natural_unity_produces_add = 3
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_valid_civic = civic_The_Druid_Way }
        }
        job_druid_add = 100 # +100 Rangers per natural blocker if GalCom approves
        mult = value:natural_blocker_count
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = @b1_upkeep
        }
    }

    triggered_desc = {
        text = biologist_is_ranger_tt
    }

    triggered_desc = {
        text = job_ranger_effect_desc
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { has_valid_civic = civic_The_Druid_Way }
        }
        text = job_druid_effect_desc
    }

    on_built = {
        planet = {
            add_blocker = { type = d_big_nature_preserve_blocker }
        }
    }

    on_destroy = {
        planet = {
            if = {
                limit = { has_deposit = d_big_nature_preserve_blocker }
                every_deposit = {
                    limit = {
                        is_deposit_type = d_big_nature_preserve_blocker
                    }
                    remove_deposit = d_big_nature_preserve_blocker
                }
            }
        }
    }
}

#贵族庄园
building_noble_estates = {
    base_buildtime = @b2_time
    icon = building_palace
    base_cap_amount = 1

    category = government

    building_sets = {
        government
        urban
    }

    potential = {
        exists = owner
        owner = {
            OR = {
                has_valid_civic = civic_aristocratic_elite
                has_valid_civic = civic_home_country_isomorphism
                has_valid_civic = civic_feudal_realm
                has_valid_civic = civic_divine_order
                has_policy_flag = hereditary_officials
            }
        }
        NOT = { has_modifier = slave_colony }
    }

    allow = {
        has_upgraded_capital = yes
        if = {
            limit = {
                exists = orbital_defence
            }
            orbital_defence = {
                exists = starbase
                starbase = {
                    NOR = {
                        has_starbase_building = ring_noble_estates
                        is_starbase_building_building = ring_noble_estates
                    }
                }
            }
        }
    }

    destroy_trigger = {
        exists = owner
        owner = {
            NOR = {
                has_valid_civic = civic_aristocratic_elite
                has_valid_civic = civic_home_country_isomorphism
                has_valid_civic = civic_feudal_realm
                has_valid_civic = civic_divine_order
                has_policy_flag = hereditary_officials
            }
        }
    }

    planet_modifier = {
        planet_housing_add = 100
    }

    inline_script = {
        script = "jobs/politician_add"
        AMOUNT = @building_static_jobs_low
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b1_minerals
        }
        upkeep = {
            energy = 2
        }
    }

    triggered_desc = {
        text = job_noble_effect_desc
    }
}