set_merchant_government_effect = {
	if = {
		limit = {
			has_technology = tech_galactic_administration
		}
		change_government = {
			authority = auth_oligarchic
			cooldown = no
			remove_invalid_civics = yes
			civics = {
				civic = civic_merchant_guilds
				civic = random
				civic = random
				civic = random
			}
		}
	}
	else = {
		change_government = {
			authority = auth_oligarchic
			cooldown = no
			remove_invalid_civics = yes
			civics = {
				civic = civic_merchant_guilds
				civic = random
				civic = random
			}
		}
	}
}

implement_human_rights_effect = {
	copy_ethos_and_authority = root
	if = {
		limit = {
			has_civic = civic_galactic_sovereign
		}
		force_remove_civic = civic_galactic_sovereign
	}
	if = {
		limit = {
			has_civic = civic_galactic_sovereign_megacorp
		}
		force_remove_civic = civic_galactic_sovereign_megacorp
	}
	if = {
		limit = {
			has_civic = civic_psionic_sovereign
		}
		force_remove_civic = civic_psionic_sovereign
	}
	if = {
		limit = {
			root = { has_authority = auth_corporate }
			has_authority = auth_corporate
		}
		set_merchant_government_effect = yes
	}
	add_modifier = { modifier = recently_human_right_implemented days = 3650 }
	add_opinion_modifier = { modifier = opinion_liberated_us who = root }
	root = {
		add_opinion_modifier = { modifier = opinion_we_liberated who = from }
	}
}

ECI_shift_ethic = {
	if = {
		limit = {
			has_theme_civics = no
		}
		shift_ethic = ethic_$ETHIC$
	}
	else = {
		ordered_pop_faction = {
			limit = {
				is_no_fanatic_government_faction = yes
				NOT = { is_same_value = event_target:TargetFaction }
			}
			order_by = value:negative_support
			position = 0
			remove_ethic_of_faction = yes
		}
		if = {
			limit = {
				has_ethic = ethic_$ETHIC$
			}
			country_remove_ethic = ethic_$ETHIC$
			country_add_ethic = ethic_fanatic_$ETHIC$
		}
		else = {
			country_add_ethic = ethic_$ETHIC$
		}
	}
}

remove_ethic_of_faction = {
	if = {
		limit = {
			OR = {
				is_pop_faction_type = progressive
				is_pop_faction_type = entrepreneurs
				is_pop_faction_type = manifesti
			}
		}
		owner = {
			country_remove_ethic = ethic_egalitarian
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = totalitarian
				is_pop_faction_type = civil_official
			}
		}
		owner = {
			country_remove_ethic = ethic_authoritarian
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = socialists
				is_pop_faction_type = pioneer
			}
		}
		owner = {
			country_remove_ethic = ethic_socialism
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = industrialist
				is_pop_faction_type = bankers
			}
		}
		owner = {
			country_remove_ethic = ethic_capitalism
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = technologist
				is_pop_faction_type = competitors
			}
		}
		owner = {
			country_remove_ethic = ethic_materialist
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = secular
				is_pop_faction_type = traditionalist
			}
		}
		owner = {
			country_remove_ethic = ethic_spiritualist
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = proletarians
				is_pop_faction_type = xenoist
			}
		}
		owner = {
			country_remove_ethic = ethic_xenophile
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = isolationist
				is_pop_faction_type = supremacist
			}
		}
		owner = {
			country_remove_ethic = ethic_xenophobe
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = prosperity
				is_pop_faction_type = philosopher
			}
		}
		owner = {
			country_remove_ethic = ethic_pacifist
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = revolutionary
				is_pop_faction_type = imperialist
			}
		}
		owner = {
			country_remove_ethic = ethic_militarist
		}
	}
	if = {
		limit = {
			is_pop_faction_type = environmentalists
		}
		owner = {
			country_remove_ethic = ethic_green
		}
	}
	if = {
		limit = {
			is_pop_faction_type = manufacturers
		}
		owner = {
			country_remove_ethic = ethic_industrial
		}
	}
}

kill_one_owner_species_pop = {
	while = {
		count = 1
		random_owned_pop = {
			limit = {
				is_same_species = root.owner.species
			}
			kill_pop = yes
		}
	}
}

build_bureaucratic_building = {
	if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				has_building = building_bureaucratic_2
				NOT = { has_building = building_bureaucratic_1 }
			}
			owner = {
				is_regular_empire = yes
				has_monthly_income = { resource = rare_crystals value >= 1 }
				has_technology = tech_galactic_bureaucracy
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_bureaucratic_2
		add_building = building_bureaucratic_3
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				has_building = building_bureaucratic_1
			}
			owner = {
				is_regular_empire = yes
				has_monthly_income = { resource = rare_crystals value >= 1 }
				has_technology = tech_colonial_bureaucracy
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_bureaucratic_1
		add_building = building_bureaucratic_2
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				free_building_slots > 0
			}
			owner = {
				is_regular_empire = yes
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		add_building = building_bureaucratic_1
	}
	else_if = {
		limit = {
			planet = {
				free_building_slots > 0
				num_buildings = { TYPE = building_planet_network_node value < 7 }
			}
			owner = {
				has_valid_civic = civic_OGAS
				NOT = { has_technology = tech_sapient_ai }
			}
		}
		add_building = building_planet_network_node
	}
	else_if = {
		limit = {
			planet = {
				free_building_slots > 0
				NOT = { has_building = building_planet_network_node }
				num_buildings = { TYPE = building_planetary_management_center value < 7 }
			}
			owner = {
				has_valid_civic = civic_OGAS
				has_technology = tech_sapient_ai
			}
		}
		add_building = building_planetary_management_center
	}
	else_if = {
		limit = {
			planet = {
				has_building = building_planet_network_node
			}
			owner = {
				has_valid_civic = civic_OGAS
				has_technology = tech_sapient_ai
			}
		}
		remove_building = building_planet_network_node
		add_building = building_planetary_management_center
	}
	else_if = {
		limit = {
			planet = {
				free_building_slots > 0
				NOT = { has_building = building_information_tower }
			}
			owner = {
				OR = {
					has_valid_civic = civic_cybercap
					has_valid_civic = civic_corporate_cybercap
				}
			}
		}
		add_building = building_information_tower
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				OR = {
					planet = { is_capital = yes }
					planet = { is_sector_capital = yes }
				}
				has_building = building_research_lab_3
			}
			owner = {
				is_regular_empire = yes
				has_monthly_income = { resource = rare_crystals value >= 2 }
				has_technology = tech_galactic_bureaucracy
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_research_lab_3
		add_building = building_bureaucratic_3
		owner = {
			if = {
				limit = {
					any_owned_planet = {
						OR = {
							has_designation = col_dome_research
							has_designation = col_research
							has_designation = col_city_refinery
							has_designation = col_ecu_research
							has_designation = col_habitat_research
							has_designation = col_ring_research
							has_building = building_research_lab_1
							has_building = building_research_lab_2
							has_building = building_research_lab_3
						}
						free_building_slots >= 1
					}
				}
				random_owned_planet = {
					limit = {
						OR = {
							has_designation = col_dome_research
							has_designation = col_research
							has_designation = col_city_refinery
							has_designation = col_ecu_research
							has_designation = col_habitat_research
							has_designation = col_ring_research
							has_building = building_research_lab_1
							has_building = building_research_lab_2
							has_building = building_research_lab_3
						}
						free_building_slots >= 1
					}
					add_building = building_bureaucratic_3
				}
			}
		}
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				OR = {
					planet = { is_capital = yes }
					planet = { is_sector_capital = yes }
				}
				has_building = building_research_lab_2
			}
			owner = {
				is_regular_empire = yes
				has_monthly_income = { resource = rare_crystals value >= 1 }
				has_technology = tech_colonial_bureaucracy
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_research_lab_2
		add_building = building_bureaucratic_2
		owner = {
			if = {
				limit = {
					any_owned_planet = {
						OR = {
							has_designation = col_dome_research
							has_designation = col_research
							has_designation = col_city_refinery
							has_designation = col_ecu_research
							has_designation = col_habitat_research
							has_designation = col_ring_research
							has_building = building_research_lab_1
							has_building = building_research_lab_2
							has_building = building_research_lab_3
						}
						free_building_slots >= 1
					}
				}
				random_owned_planet = {
					limit = {
						OR = {
							has_designation = col_dome_research
							has_designation = col_research
							has_designation = col_city_refinery
							has_designation = col_ecu_research
							has_designation = col_habitat_research
							has_designation = col_ring_research
							has_building = building_research_lab_1
							has_building = building_research_lab_2
							has_building = building_research_lab_3
						}
						free_building_slots >= 1
					}
					add_building = building_bureaucratic_2
				}
			}
		}
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				OR = {
					planet = { is_capital = yes }
					planet = { is_sector_capital = yes }
				}
				has_building = building_research_lab_1
			}
			owner = {
				is_regular_empire = yes
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_research_lab_1
		add_building = building_bureaucratic_1
		owner = {
			if = {
				limit = {
					any_owned_planet = {
						OR = {
							has_designation = col_dome_research
							has_designation = col_research
							has_designation = col_city_refinery
							has_designation = col_ecu_research
							has_designation = col_habitat_research
							has_designation = col_ring_research
							has_building = building_research_lab_1
							has_building = building_research_lab_2
							has_building = building_research_lab_3
						}
						free_building_slots >= 1
					}
				}
				random_owned_planet = {
					limit = {
						OR = {
							has_designation = col_dome_research
							has_designation = col_research
							has_designation = col_city_refinery
							has_designation = col_ecu_research
							has_designation = col_habitat_research
							has_designation = col_ring_research
							has_building = building_research_lab_1
							has_building = building_research_lab_2
							has_building = building_research_lab_3
						}
						free_building_slots >= 1
					}
					add_building = building_bureaucratic_1
				}
			}
		}
	}
}

build_city = {
	if = {
		limit = {
			planet = {
				OR = {
					uses_district_set = standard
					uses_district_set = hive_world
					uses_district_set = machine_world
					uses_district_set = shattered_ring_world
				}
			}
			owner = { is_regular_empire = yes }
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_city
			}
		}
	}
	if = {
		limit = {
			planet = {
				OR = {
					uses_district_set = standard
					uses_district_set = hive_world
					uses_district_set = machine_world
					uses_district_set = shattered_ring_world
				}
			}
			owner = { is_hive_empire = yes }
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_hive
			}
		}
	}
	if = {
		limit = {
			planet = {
				OR = {
					uses_district_set = standard
					uses_district_set = hive_world
					uses_district_set = machine_world
					uses_district_set = shattered_ring_world
				}
			}
			owner = { is_machine_empire = yes }
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_nexus
			}
		}
	}
	if = {
		limit = {
			planet = {
				OR = {
					uses_district_set = city_world
					uses_district_set = pdecocity
					uses_district_set = pdmilarc
					uses_district_set = pdcorpoarc
				}
			}
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_arcology_housing
			}
		}
	}
	if = {
		limit = {
			planet = {
				uses_district_set = habitat
			}
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_hab_housing
			}
		}
	}
	if = {
		limit = {
			planet = { uses_district_set = ring_world }
			owner = { is_regular_empire = yes }
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_rw_city
			}
		}
	}
	if = {
		limit = {
			planet = { uses_district_set = ring_world }
			owner = { is_hive_empire = yes }
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_rw_hive
			}
		}
	}
	if = {
		limit = {
			planet = { uses_district_set = ring_world }
			owner = { is_machine_empire = yes }
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_rw_nexus
			}
		}
	}
}

spawn_god_habitat = {
	spawn_planet = {
		class = "pc_habitat"
		location = event_target:spawn_god_ship_planet
		orbit_location = yes
		orbit_angle_offset = 45
		orbit_distance_offset = 9.899
		size = 10
		has_ring = no

		init_effect = {
			set_name = "NAME_Payback_Warship_GOD"
			set_planet_entity = {
				entity = "fc_01_evil_slaver_hab_entity"
			}
			set_surveyed = {
				surveyed = yes
				surveyor = FROM
			}
			set_all_comms_surveyed = yes
			clear_blockers = yes

			set_planet_flag = megastructure
			set_planet_flag = habitat
			set_planet_flag = advanced_habitat
			set_planet_flag = advanced_habitat_2
			set_planet_flag = payback_habitat
			set_planet_flag = research_habitat
		}
	}
}

country_create_all_direct_democratic_councilor = {
	random_owned_leader = {
		limit = {
			leader_class = official
			is_ruler = no
		}
		set_council_position = councilor_direct_democratic_governor
	}
	create_leader = {
		class = scientist
		sub_type = survey
		name = random
		species = owner_main_species
		effect = { set_council_position = councilor_direct_democratic_scientist }
	}
	create_leader = {
		class = commander
		sub_type = survey
		name = random
		species = owner_main_species
		effect = { set_council_position = councilor_direct_democratic_general }
	}
	create_leader = {
		class = official
		sub_type = survey
		name = random
		species = owner_main_species
		effect = { set_council_position = councilor_direct_democratic_culture }
	}
	random_owned_leader = {
		limit = {
			leader_class = commander
			is_ruler = no
		}
		set_council_position = councilor_direct_democratic_admiral
	}
}

synethic_ascension_change_portrait = {
	if = {
		limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
		prev = {
			switch = {
				trigger = is_species_class
				HUM = { prev = { change_species_characteristics = { portrait = "sd_hum_robot" } } }
				MAM = { prev = { change_species_characteristics = { portrait = "sd_mam_robot" } } }
				REP = { prev = { change_species_characteristics = { portrait = "sd_rep_robot" } } }
				AVI = { prev = { change_species_characteristics = { portrait = "sd_avi_robot" } } }
				ART = { prev = { change_species_characteristics = { portrait = "sd_art_robot" } } }
				MOL = { prev = { change_species_characteristics = { portrait = "sd_mol_robot" } } }
				FUN = { prev = { change_species_characteristics = { portrait = "sd_fun_robot" } } }
				PLANT = { prev = { change_species_characteristics = { portrait = "sd_pla_robot" } } }
				LITHOID = { prev = { change_species_characteristics = { portrait = "lith_machine" } } }
				NECROID = { prev = { change_species_characteristics = { portrait = "nec_machine" } } }
				AQUATIC = { prev = { change_species_characteristics = { portrait = "aqu_machine" } } }
				TOX = { prev = { change_species_characteristics = { portrait = "tox_machine" } } }
			}
		}
	}

	rename_species = {
		prompt_country = root #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
		name_list = ascension_list
	}
}

impose_ideology_effect = {
	copy_ethos_and_authority = root
	if = {
		limit = {
			has_civic = civic_galactic_sovereign
		}
		force_remove_civic = civic_galactic_sovereign
	}
	if = {
		limit = {
			has_civic = civic_galactic_sovereign_megacorp
		}
		force_remove_civic = civic_galactic_sovereign_megacorp
	}
	if = {
		limit = {
			has_civic = civic_psionic_sovereign
		}
		force_remove_civic = civic_psionic_sovereign
	}
	if = {
		limit = {
			root = { has_authority = auth_corporate }
			has_authority = auth_corporate
		}
		set_merchant_government_effect = yes
	}
	add_modifier = { modifier = recently_liberated days = 7300 }
	add_opinion_modifier = { modifier = opinion_liberated_us who = root }
	root = {
		add_opinion_modifier = { modifier = opinion_we_liberated who = from }
	}
}

impose_subject_ideology_effect = {
	copy_ethos_and_authority = root
	if = {
		limit = {
			has_civic = civic_galactic_sovereign
		}
		force_remove_civic = civic_galactic_sovereign
	}
	if = {
		limit = {
			has_civic = civic_galactic_sovereign_megacorp
		}
		force_remove_civic = civic_galactic_sovereign_megacorp
	}
	if = {
		limit = {
			has_civic = civic_psionic_sovereign
		}
		force_remove_civic = civic_psionic_sovereign
	}
	if = {
		limit = {
			root = { has_authority = auth_corporate }
			has_authority = auth_corporate
		}
		set_merchant_government_effect = yes
	}
	if = {
		limit = {
			root = { has_civic = civic_crusader_spirit }
		}
		force_remove_civic = 1
		force_add_civic = civic_crusader_spirit
	}
	add_modifier = { modifier = recently_liberated days = 7300 }
	add_opinion_modifier = { modifier = opinion_liberated_us who = root }
	root = {
		add_opinion_modifier = { modifier = opinion_we_liberated who = from }
	}
}

remove_theme_civics = {
	if = {
		limit = {
			has_civic = civic_feudal_realm
		}
		force_remove_civic = civic_feudal_realm
	}
	if = {
		limit = {
			has_civic = civic_aristocratic_elite
		}
		force_remove_civic = civic_aristocratic_elite
	}
	if = {
		limit = {
			has_civic = civic_coalition_government
		}
		force_remove_civic = civic_coalition_government
	}
	if = {
		limit = {
			has_civic = civic_constitutional_parliament
		}
		force_remove_civic = civic_constitutional_parliament
	}
	if = {
		limit = {
			OR = {
				has_civic = civic_shared_burden
				has_civic = civic_advanced_socialism
			}
		}
		force_remove_civic = civic_shared_burden
	}
	if = {
		limit = {
			has_civic = civic_socialistic
		}
		force_remove_civic = civic_socialistic
	}
	if = {
		limit = {
			has_civic = civic_nazbol
		}
		force_remove_civic = civic_nazbol
	}
	if = {
		limit = {
			has_civic = civic_glory_and_dream
		}
		force_remove_civic = civic_glory_and_dream
	}
	if = {
		limit = {
			has_civic = civic_ultimate_collective
		}
		force_remove_civic = civic_ultimate_collective
	}
	if = {
		limit = {
			has_civic = civic_beacon_of_liberty
		}
		force_remove_civic = civic_beacon_of_liberty
	}
	if = {
		limit = {
			has_civic = civic_merchant_guilds
		}
		force_remove_civic = civic_merchant_guilds
	}
	if = {
		limit = {
			has_civic = civic_citizen_service
		}
		force_remove_civic = civic_citizen_service
	}
	if = {
		limit = {
			has_civic = civic_citizen_service
		}
		force_remove_civic = civic_military_junta
	}
	if = {
		limit = {
			has_civic = civic_military_dictatorship
		}
		force_remove_civic = civic_military_dictatorship
	}
	if = {
		limit = {
			has_civic = civic_peaceful_republic
		}
		force_remove_civic = civic_peaceful_republic
	}
	if = {
		limit = {
			has_civic = civic_executive_committee
		}
		force_remove_civic = civic_executive_committee
	}
	if = {
		limit = {
			has_civic = civic_philosopher_king
		}
		force_remove_civic = civic_philosopher_king
	}
	if = {
		limit = {
			has_civic = civic_spiritual_democracy
		}
		force_remove_civic = civic_spiritual_democracy
	}
	if = {
		limit = {
			has_civic = civic_exalted_priesthood
		}
		force_remove_civic = civic_exalted_priesthood
	}
	if = {
		limit = {
			has_civic = civic_imperial_cult
		}
		force_remove_civic = civic_imperial_cult
	}
	if = {
		limit = {
			has_civic = civic_cyber_demos_cratos
		}
		force_remove_civic = civic_cyber_demos_cratos
	}
	if = {
		limit = {
			has_civic = civic_technocracy
		}
		force_remove_civic = civic_technocracy
	}
	if = {
		limit = {
			has_civic = civic_cyber_dictatorship
		}
		force_remove_civic = civic_cyber_dictatorship
	}
}

red_dowm_redux = {
	event_target:red_dawn_enemy = {
		create_species = {
			name = NAME_red_dawn
			class = PARAGON
			portrait = stardust_huazhang
			namelist = "HUMAN4"
			traits = {
				trait = trait_pc_nuked_preference
				trait = trait_cybernetic
				trait = trait_psionic
				trait = trait_erudite
				trait = trait_cyborg_logic_engines
				trait = trait_cyborg_enhanced_memory
				trait = trait_cyborg_learning_algorithms
			}
			effect = {
				save_event_target_as = huazhang_species_2
			}
		}
		create_leader = {
			species = event_target:huazhang_species_2
			event_leader = yes
			class = commander
			name = PRESCRIPTED_ruler_name_humans4
			skill = 10
			randomize_traits = no
			skip_background_generation = yes
			background_ethic = ethic_socialism
			custom_catch_phrase = huazhang_leader_catch_phrase
			custom_description = huazhang_leader_desc
			background_job = researcher
			traits = {
				trait = leader_trait_eci_legendary_leader
				trait = leader_trait_academia_recruiter
				trait = leader_trait_red_dawn
				trait = leader_trait_huazhang
				trait = leader_trait_consul_general_3
				trait = leader_trait_home_guard_3
			}
			gender = indeterminable
			set_age = 30
			hide_age = yes
			effect = {
				save_global_event_target_as = huazhang_2
				set_leader_flag = legendary_leader
				set_leader_flag = immune_to_negative_traits
				set_leader_flag = huazhang
				set_owner = event_target:red_dawn_enemy
			}
		}

		set_country_type = default
		shift_ethic = ethic_fanatic_egalitarian
		shift_ethic = ethic_fanatic_socialism
		country_remove_ethic = ethic_xenophobe
		shift_ethic = ethic_egalitarian
		shift_ethic = ethic_fanatic_socialism
		change_government = {
			authority = auth_democratic
			cooldown = no
			remove_invalid_civics = yes
		}
		force_remove_civic = civic_lethargic_leadership
		force_remove_civic = civic_empire_in_decline
		force_remove_civic = civic_revanchist_fervor
		force_add_civic = civic_distribution_on_demand
		force_add_civic = civic_shared_burden
		force_add_civic = civic_OGAS

		set_empire_name = NAME_new_red_dawn
		change_country_flag = {
			icon = {
				category = "red_dawn"
				file = "red_dawn.dds"
			}
			background = {
				category = "backgrounds"
				file = "sinus.dds"
			}
			colors={
				"red"
				"red"
				"null"
				"null"
			}
		}

		set_leader = event_target:huazhang_2

		add_tradition = tr_harmony_adopt
		add_tradition = tr_harmony_the_greater_good
		add_tradition = tr_harmony_kinship
		add_tradition = tr_harmony_utopian_dream
		add_tradition = tr_harmony_harmonious_directives
		add_tradition = tr_harmony_mind_and_body
		add_tradition = tr_harmony_finish

		add_tradition = tr_right_adopt
		add_tradition = tr_right_talent_promotion
		add_tradition = tr_right_peoples_participation_in_politics
		add_tradition = tr_right_natural_rights
		add_tradition = tr_right_freedom_thought
		add_tradition = tr_right_boundaries_of_freedom
		add_tradition = tr_right_finish

		add_tradition = tr_revolution_adopt
		add_tradition = tr_revolution_army_of_peoples
		add_tradition = tr_revolution_army_of_freedom
		add_tradition = tr_revolution_army_of_democracy
		add_tradition = tr_revolution_revolutionary_spirit
		add_tradition = tr_revolution_revolutionary_propaganda
		add_tradition = tr_revolution_finish

		add_tradition = tr_future_adopt
		add_tradition = tr_future_technology
		add_tradition = tr_future_industry
		add_tradition = tr_future_military
		add_tradition = tr_future_society
		add_tradition = tr_future_economy
		add_tradition = tr_future_finish

		add_resource = {
			minerals = 99999
			energy = 99999
			food = 99999
			alloys = 99999
			consumer_goods = 99999
			volatile_motes = 30000
			exotic_gases = 30000
			rare_crystals = 30000
			sr_living_metal = 10000
			sr_zro = 10000
			sr_dark_matter = 10000
			nanites = 10000
			minor_artifacts = 1000
			influence = 1000
		}
	}
}

red_dowm_gift = {
	create_fleet = {
		name = "HUMAN4_FLEET_Peacefleet"
		effect = {
			set_owner = event_target:red_dawn_enemy
			while = {
				count = 1
				create_fallen_empire_titan = yes
			}
			while = {
				count = 3
				create_fallen_empire_large_ship = yes
			}
			while = {
				count = 7
				create_fallen_empire_small_ship = yes
			}
			set_location = {
				target = event_target:huazhang_rest_area.capital_star
				distance = 45
				angle = random
			}
			set_owner = event_target:huazhang_rest_area
		}
	}
}

red_dowm_war = {
	every_country = {
		limit = {
			is_fallen_empire_spiritualist = yes
		}
		save_global_event_target_as = decayed_fallen_empire_1
	}
	every_country = {
		limit = {
			is_fallen_empire_xenophile = yes
		}
		save_global_event_target_as = decayed_fallen_empire_2
	}
	every_country = {
		limit = {
			is_fallen_empire_xenophobe = yes
		}
		save_global_event_target_as = decayed_fallen_empire_3
	}
	declare_war = {
		target = event_target:decayed_fallen_empire_1
		attacker_war_goal = wg_galactic_revolution
		name = "casus_belli_cb_galactic_revolution"
	}
	declare_war = {
		target = event_target:decayed_fallen_empire_2
		attacker_war_goal = wg_galactic_revolution
		name = "casus_belli_cb_galactic_revolution"
	}
	declare_war = {
		target = event_target:decayed_fallen_empire_3
		attacker_war_goal = wg_galactic_revolution
		name = "casus_belli_cb_galactic_revolution"
	}
}

mobilize_pop = {
	if = {
		limit = {
			is_robot_pop = yes
		}
		if = {
			limit = {
				owner = {
					has_technology = tech_synthetic_workers
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "robotic_conscript_army_3"
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					has_technology = tech_droid_workers
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "robotic_conscript_army_2"
				}
			}
		}
		else = {
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "robotic_conscript_army"
				}
			}
		}
	}
	else = {
		if = {
			limit = {
				is_enslaved = yes
			}
			if = {
				limit = {
					AND = {
						has_slavery_type = { type = slavery_military }
						OR = {
							has_trait = trait_psionic
							has_job = legendary_mage
							has_job = magician
							has_job = magical_apprentice
							has_job = telepath
						}
					}
				}
				planet = {
					create_army = {
						name = random
						owner = root.owner
						species = prev
						type = "psionic_conscript_army"
					}
				}
			}
			else_if = {
				limit = {
					has_slavery_type = { type = slavery_military }
				}
				planet = {
					create_army = {
						name = random
						owner = root.owner
						species = prev
						type = "thrall_conscript_army"
					}
				}
			}
			else = {
				planet = {
					create_army = {
						name = random
						owner = root.owner
						species = prev
						type = "slave_conscript_army"
					}
				}
			}
		}
		else = {
			if = {
				limit = {
					owner = {
						has_policy_flag = sparta_system
					}
				}
				planet = {
					create_army = {
						name = random
						owner = root.owner
						species = prev
						type = "citizen_warrior"
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						has_trait = trait_psionic
						has_job = legendary_mage
						has_job = magician
						has_job = magical_apprentice
						has_job = telepath
					}
				}
				planet = {
					if = {
						limit = {
							owner = {
								has_policy_flag = militia_association
							}
						}
						create_army = {
							name = random
							owner = root.owner
							species = prev
							type = "psionic_militia_army"
						}
					}
					else = {
						create_army = {
							name = random
							owner = root.owner
							species = prev
							type = "psionic_conscript_army"
						}
					}
				}
			}
			else_if = {
				limit = {
					AND = {
						OR = {
							has_trait = trait_clone_soldier_infertile
							has_trait = trait_clone_soldier_infertile
						}
						has_trait = trait_latent_psionic
					}
				}
				planet = {
					random_list = {
						1 = {
							if = {
								limit = {
									owner = {
										OR = {
											has_policy_flag = militia_association
											has_civic = civic_martial_brotherhood
										}
									}
								}
								create_army = {
									name = random
									owner = root.owner
									species = prev
									type = "psionic_militia_army"
								}
							}
							else = {
								create_army = {
									name = random
									owner = root.owner
									species = prev
									type = "psionic_conscript_army"
								}
							}
						}
						4 = {
							create_army = {
								name = random
								owner = root.owner
								species = prev
								type = "clone_conscript_army"
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					has_trait = trait_latent_psionic
				}
				planet = {
					random_list = {
						1 = {
							if = {
								limit = {
									owner = {
										OR = {
											has_policy_flag = militia_association
											has_civic = civic_martial_brotherhood
										}
									}
								}
								create_army = {
									name = random
									owner = root.owner
									species = prev
									type = "psionic_militia_army"
								}
							}
							else = {
								create_army = {
									name = random
									owner = root.owner
									species = prev
									type = "psionic_conscript_army"
								}
							}
						}
						4 = {
							if = {
								limit = {
									owner = {
										OR = {
											has_policy_flag = militia_association
											has_civic = civic_martial_brotherhood
										}
									}
								}
								create_army = {
									name = random
									owner = root.owner
									species = prev
									type = "militia_army"
								}
							}
							else = {
								create_army = {
									name = random
									owner = root.owner
									species = prev
									type = "conscript_army"
								}
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						has_trait = trait_clone_soldier_infertile
						has_trait = trait_clone_soldier_infertile
					}
				}
				planet = {
					create_army = {
						name = random
						owner = root.owner
						species = prev
						type = "clone_conscript_army"
					}
				}
			}
			else = {
				planet = {
					if = {
						limit = {
							owner = {
								OR = {
									has_policy_flag = militia_association
									has_civic = civic_martial_brotherhood
								}
							}
						}
						create_army = {
							name = random
							owner = root.owner
							species = prev
							type = "militia_army"
						}
					}
					else = {
						create_army = {
							name = random
							owner = root.owner
							species = prev
							type = "conscript_army"
						}
					}
				}
			}
		}
		if = {
			limit = {
				planet = {
					OR = {
						has_building = building_clone_vats
						has_building = building_advanced_clone_vats
						has_building = building_clone_army_clone_vat
						has_building = building_clone_guard_clone_vat
					}
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "clone_conscript_army"
				}
			}
		}
		if = {
			limit = {
				has_job = necromancer
			}
			planet = {
				while = {
					count = 5
					create_army = {
						name = random
						owner = root.owner
						species = prev
						type = "undead_conscript_army"
					}
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_policy_flag = all_people_are_soldiers
			}
		}
		add_modifier = {
			modifier = modifier_mobilization_pop_4
			days = -1
		}
	}
	else_if = {
		limit = {
			owner = {
				has_policy_flag = extensive_conscription
			}
		}
		add_modifier = {
			modifier = modifier_mobilization_pop_3
			days = -1
		}
	}
	else_if = {
		limit = {
			owner = {
				has_policy_flag = limited_conscription
			}
		}
		add_modifier = {
			modifier = modifier_mobilization_pop_2
			days = -1
		}
	}
	else = {
		add_modifier = {
			modifier = modifier_mobilization_pop_1
			days = -1
		}
	}
}

#军事采邑制
mobilize_planet = {
	every_owned_pop = {
		limit = {
			OR = {
				has_job = knight_commander
				has_job = knight
			}
		}
		if = {
			limit = {
				is_robot_pop = yes
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "steel_knight_warband"
				}
			}
		}
		else_if = {
			limit = {
				has_trait = trait_cybernetic
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "cyber_knight_warband"
				}
			}
		}
		else_if = {
			limit = {
				OR = {
					has_trait = trait_psionic
					has_trait = trait_latent_psionic
					has_job = legendary_mage
					has_job = magician
					has_job = magical_apprentice
					has_job = telepath
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "magic_knight_warband"
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					has_technology = tech_gene_seed_purification
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "gene_knight_warband"
				}
			}
		}
		else = {
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "knight_warband"
				}
			}
		}
	}
	every_owned_pop = {
		limit = {
			has_job = squire
		}
		if = {
			limit = {
				is_robot_pop = yes
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "steel_squire_warband"
				}
			}
		}
		else_if = {
			limit = {
				has_trait = trait_cybernetic
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "cyber_squire_warband"
				}
			}
		}
		else_if = {
			limit = {
				OR = {
					has_trait = trait_psionic
					has_trait = trait_latent_psionic
					has_job = legendary_mage
					has_job = magician
					has_job = magical_apprentice
					has_job = telepath
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "magic_squire_warband"
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					has_technology = tech_gene_seed_purification
				}
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "gene_squire_warband"
				}
			}
		}
		else = {
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "squire_warband"
				}
			}
		}
	}
	every_owned_pop = {
		limit = {
			OR = {
				has_military_service_type = { type = military_service_full }
				has_military_service_type = { type = military_service_limited }
			}
			OR = {
				is_pop_category = worker
				is_pop_category = slave
			}
		}
		if = {
			limit = {
				is_robot_pop = yes
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "machine_draftees"
				}
			}
		}
		else_if = {
			limit = {
				has_slavery_type = { type = slavery_military }
				is_enslaved = yes
			}
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "slave_guard"
				}
			}
		}
		else = {
			planet = {
				create_army = {
					name = random
					owner = root.owner
					species = prev
					type = "peasant_draftees"
				}
			}
		}
	}
}

revolution_storm_add = {
	set_cosmic_storm = {
		cosmic_storm = prev
	}

	set_star_flag = storm_system
	set_global_flag = cosmic_storm_has_occurred

	inline_script = {
		script = cosmic_storms/StormVisuals
		STORM_NAME = "revolution_storm"
	}
}

revolution_storm_remove = {
	remove_storm_visuals_effect = yes
	remove_star_flag = storm_system

	if = {
		limit = {
			has_owner = yes
		}
		owner = {
			remove_country_flag = affected_by_shroud_storm
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = { is_galactic_revolution_target = yes }
		}
		owner = {
			revolution_storm_apply_aftermath_modifier = yes
			revolution_storm_apply_deposits = yes
		}
	}
}

revolution_storm_apply_aftermath_modifier = {
	every_system_planet = {
		limit = {
			is_colony = yes
		}

		storm_apply_aftermath_modifier = {

			severity = {
				modifier = "revolution_storm_aftermath_modifier_severity_1"
				days = @Severity1Duration
				chance = {
					base = @Severity1BaseChance
					modifier = {
						factor = 0
						OR = {
							has_modifier = "revolution_storm_aftermath_modifier_severity_2"
							has_modifier = "revolution_storm_aftermath_modifier_severity_3"
						}
					}
					modifier = {
						factor =  $FactorSev1|1$
					}
				}

				effect = {
					set_timed_planet_flag = {
						flag = AFFECTED_BY_REVOLUTION_STORM
						days = @Severity1Duration
					}
				}
			}

			severity = {
				modifier = "revolution_storm_aftermath_modifier_severity_2"
				days = @Severity2Duration
				chance = {
					base = @Severity2BaseChance
					modifier = {
						factor = 0
						has_modifier = "revolution_storm_aftermath_modifier_severity_3"
					}
					modifier = {
						factor =  $FactorSev2|1$
					}
				}

				effect = {
					set_timed_planet_flag = {
						flag = AFFECTED_BY_REVOLUTION_STORM
						days = @Severity2Duration
					}
				}
			}

			severity = {
				modifier = "revolution_storm_aftermath_modifier_severity_3"
				days = @Severity3Duration
				chance = {
					base = @Severity3BaseChance
					modifier = {
						factor =  $FactorSev3|1$
					}
				}

				effect = {
					set_timed_planet_flag = {
						flag = AFFECTED_BY_REVOLUTION_STORM
						days = @Severity3Duration
					}
				}
			}
		}

		if = {
			limit = { is_colony = yes }
			owner = {
				create_message = {
					type = SHROUD_STORM_AFTERMATH
					localization = MESSAGE_REVOLUTION_STORM_AFTERMATH_DESC
					days = @toast_important_message_days
					target = prev
					variable = {
						type = name
						localization = PLANET
						scope = prev
					}
					custom_toast_content_text = revolution_storm_aftermath_custom_desc
				}
			}
		}
	}
}

revolution_storm_apply_deposits = {
	every_system_planet = {
		limit = {
			OR = {
				is_colonizable = yes
				is_colony = yes
			}
			is_artificial = no
			NOT = { has_deposit = d_monument_to_the_victims }
		}

		random_list = {
			80 = {}
			20 = {
				add_deposit = d_monument_to_the_victims
				if = {
					limit = {
						has_owner = yes
					}
					planet_event = { id = cstorms.80000 }
				}
			}
		}
	}
}

remove_building_private_commercial_megaplex = {
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
	remove_deposit = d_ethic_private_commercial_t2N
}